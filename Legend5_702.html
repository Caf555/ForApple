<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹‡è€…å‚³èªªï¼šäº”åŸŸå¾é€” - å®Œæ•´åœ–ç‰‡ç‰ˆ</title>
    <meta name="description" content="å°ˆç‚ºæ‰‹æ©Ÿå„ªåŒ–çš„æ–‡å­—å†’éšªRPGéŠæˆ² - åŒ…å«æ‰€æœ‰AIç”Ÿæˆåœ–ç‰‡">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
        }

        .game-card {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .btn {
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary { background: linear-gradient(45deg, #dc2626, #ef4444); }
        .btn-secondary { background: linear-gradient(45deg, #2563eb, #3b82f6); }
        .btn-success { background: linear-gradient(45deg, #16a34a, #22c55e); }
        .btn-purple { background: linear-gradient(45deg, #7c3aed, #8b5cf6); }
        .btn-warning { background: linear-gradient(45deg, #d97706, #f59e0b); }

        .health-bar, .mp-bar, .exp-bar {
            transition: width 0.5s ease-in-out;
        }

        @keyframes fadeUp {
            0% { opacity: 1; transform: translateY(0px); }
            100% { opacity: 0; transform: translateY(-30px); }
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes slideIn {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes gentleGlow {
            0%, 100% { box-shadow: 0 0 3px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 8px rgba(59, 130, 246, 0.5); }
        }

        @keyframes gentleBreathing {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.005); filter: brightness(1.02); }
        }

        @keyframes combatShake {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.02) rotate(0.5deg); }
            75% { transform: scale(0.98) rotate(-0.5deg); }
        }

        @keyframes levelUpGlow {
            0% { transform: scale(1); filter: brightness(1) saturate(1); }
            50% { transform: scale(1.01); filter: brightness(1.1) saturate(1.2); }
            100% { transform: scale(1); filter: brightness(1) saturate(1); }
        }

        @keyframes healthWarning {
            0%, 100% { filter: brightness(1) hue-rotate(0deg); }
            50% { filter: brightness(1.05) hue-rotate(-5deg) saturate(1.1); }
        }

        @keyframes manaBoost {
            0%, 100% { filter: brightness(1) hue-rotate(0deg); }
            50% { filter: brightness(1.03) hue-rotate(5deg) saturate(1.05); }
        }

        .combat-animation {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: fadeUp 2s ease-out forwards;
            z-index: 1000;
        }

        .image-gentle-transition {
            animation: gentleBreathing 4s ease-in-out infinite;
        }

        .image-combat-shake {
            animation: combatShake 0.6s ease-in-out;
        }

        .image-level-up {
            animation: levelUpGlow 2s ease-in-out;
        }

        .image-health-warning {
            animation: healthWarning 3s ease-in-out infinite;
        }

        .image-mana-boost {
            animation: manaBoost 3s ease-in-out infinite;
        }

        .quick-menu-enter {
            animation: fadeIn 0.3s ease-out;
        }

        .gentle-glow {
            animation: gentleGlow 3s ease-in-out infinite;
        }

        /* åœ–ç‰‡æ¡†æ¨£å¼ */
        .image-container {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-bottom: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64748b;
            background: radial-gradient(circle at center, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
        }

        .image-placeholder-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            opacity: 0.7;
        }

        /* æ‰‹æ©Ÿå„ªåŒ–å¸ƒå±€ */
        .mobile-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .top-panel {
            flex-shrink: 0;
        }

        .main-game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .bottom-panel {
            flex-shrink: 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        /* æˆ°é¬¥ç•Œé¢ç‰¹æ®Šå¸ƒå±€ - ä¿®æ­£æ—¥èªŒæ“ å£“æŒ‰éˆ•å•é¡Œ */
        .battle-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .battle-info {
            flex-shrink: 0;
        }

        .battle-log {
            flex: 0 0 auto;
            height: 120px;
            overflow-y: auto;
            margin: 0.5rem 0;
        }

        .battle-actions {
            flex-shrink: 0;
            max-width: 100%;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        /* æ¨™ç±¤é ç³»çµ± */
        .tab-container {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 1rem;
        }

        .tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .tab-content {
            min-height: 200px;
        }

        /* ç·Šæ¹Šçš„æ—¥èªŒæ¨£å¼ */
        .compact-log {
            height: 100%;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 0.25rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry {
            font-size: 0.75rem;
            padding: 0.25rem;
            margin-bottom: 0.2rem;
            border-radius: 4px;
            line-height: 1.2;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .log-entry:first-child {
            border-left-color: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
        }

        /* é€²åº¦æ¢å„ªåŒ– */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        /* ä¿®æ­£ç‰ˆå¿«é€Ÿè¡Œå‹•åˆ— */
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            align-items: stretch;
            max-width: 100%;
            overflow: hidden;
            margin-top: 1rem;
        }

        .quick-action-btn {
            flex: 1;
            min-width: 70px;
            max-width: 120px;
            padding: 0.75rem 0.5rem;
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            text-align: center;
            word-break: break-word;
            line-height: 1.2;
            min-height: 65px;
        }

        .quick-action-btn span {
            display: block;
            width: 100%;
        }

        .quick-action-btn span:first-child {
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        /* éŸ¿æ‡‰å¼ç¶²æ ¼ - é›»è…¦ç‰ˆå„ªåŒ– */
        @media (min-width: 768px) {
            .mobile-layout {
                display: grid;
                grid-template-columns: 350px 1fr 300px;
                grid-template-rows: auto 1fr;
                gap: 1rem;
                padding: 1rem;
                max-width: 1400px;
                margin: 0 auto;
                overflow: hidden;
            }

            .top-panel {
                grid-column: 1;
                grid-row: 1 / -1;
                max-width: 350px;
                overflow: hidden;
            }

            .main-game-area {
                grid-column: 2;
                grid-row: 1 / -1;
                max-width: 100%;
                overflow: hidden;
            }

            .bottom-panel {
                grid-column: 3;
                grid-row: 1 / -1;
                max-height: none;
                max-width: 300px;
                overflow: hidden;
            }

            .image-container {
                height: 250px;
            }

            .quick-actions {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
                gap: 0.5rem;
                max-width: 100%;
                overflow: hidden;
            }

            .quick-action-btn {
                padding: 0.6rem 0.4rem;
                font-size: 0.75rem;
                min-height: 65px;
                flex: none;
                min-width: 85px;
                max-width: none;
            }

            .battle-container {
                padding: 0.5rem;
                max-height: calc(100vh - 300px);
            }

            .battle-log {
                height: 140px;
            }
        }

        /* æ‰‹æ©Ÿç‰ˆæˆ°é¬¥æŒ‰éˆ•å„ªåŒ– */
        @media (max-width: 767px) {
            .mobile-layout {
                padding: 0.5rem;
                gap: 0.75rem;
                overflow: hidden;
            }

            .battle-container {
                height: 100%;
                max-height: calc(100vh - 280px);
            }

            .battle-log {
                height: 100px;
                margin: 0.25rem 0;
            }

            .quick-actions {
                display: flex;
                flex-wrap: wrap;
                gap: 0.3rem;
                justify-content: center;
                max-width: 100%;
                overflow: hidden;
            }

            .quick-action-btn {
                flex: 1;
                min-width: 60px;
                max-width: 85px;
                padding: 0.5rem 0.25rem;
                font-size: 0.65rem;
                min-height: 55px;
                word-break: break-word;
            }

            .tab {
                font-size: 0.8rem;
                padding: 0.5rem;
            }

            .image-container {
                height: 160px;
            }

            .battle-container {
                padding: 0.25rem;
                max-width: 100%;
                overflow: hidden;
            }

            .battle-actions {
                padding: 0;
                max-width: 100%;
                overflow: hidden;
                margin-top: 0.25rem;
            }

            .quick-action-btn span {
                text-align: center;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                max-width: 100%;
            }

            .quick-actions:has(.quick-action-btn:nth-child(5)) {
                justify-content: flex-start;
            }

            .quick-actions:has(.quick-action-btn:nth-child(5)) .quick-action-btn {
                flex: 0 0 calc(50% - 0.15rem);
                max-width: calc(50% - 0.15rem);
            }
        }

        /* è¶…å°è¢å¹•å„ªåŒ– */
        @media (max-width: 480px) {
            .quick-action-btn {
                min-width: 60px;
                max-width: 80px;
                font-size: 0.65rem;
                padding: 0.5rem 0.25rem;
                min-height: 55px;
            }

            .quick-action-btn span:first-child {
                font-size: 0.9rem;
            }
        }

        .input-field {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .class-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .class-card {
            padding: 1rem;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .class-card.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .sticky-header {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .copy-prompt-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(59, 130, 246, 0.8);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .copy-prompt-btn:hover {
            background: rgba(59, 130, 246, 1);
        }

        /* åœ–ç‰‡åº«å°ˆç”¨æ¨£å¼ */
        .gallery-container {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .gallery-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .gallery-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gallery-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .filter-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .gallery-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
        }

        .gallery-item-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gallery-item-title {
            font-size: 1rem;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .gallery-item-category {
            font-size: 0.8rem;
            color: #9ca3af;
            background: rgba(59, 130, 246, 0.2);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
        }

        .gallery-item-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .gallery-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item-placeholder {
            color: #64748b;
            text-align: center;
        }

        .gallery-item-footer {
            padding: 1rem;
        }

        .gallery-item-prompt {
            font-size: 0.8rem;
            color: #d1d5db;
            line-height: 1.4;
            margin-bottom: 1rem;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .gallery-item-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .gallery-action-btn {
            flex: 1;
            min-width: 80px;
            padding: 0.5rem;
            font-size: 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .gallery-container {
                padding: 0.5rem;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .gallery-filters {
                gap: 0.25rem;
            }

            .filter-btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: white;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-size: 1.2rem;
        ">
            âš”ï¸ æ­£åœ¨è¼‰å…¥å‹‡è€…å‚³èªª...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        const AdventureGame = () => {
            const [gameState, setGameState] = useState('menu');
            const [selectedClass, setSelectedClass] = useState(null);
            const [currentImage, setCurrentImage] = useState({ prompt: '', title: '', imageUrl: '' });
            const [uploadedImages, setUploadedImages] = useState({});
            const [showImageUpload, setShowImageUpload] = useState(false);
            const [imageDisplayMode, setImageDisplayMode] = useState('cover');
            const [galleryFilter, setGalleryFilter] = useState('all');
            const [isLoading, setIsLoading] = useState(true);

            // ğŸ¬ é è¨­åœ–ç‰‡é€£çµåº« - ä¾†è‡ªGitHub
            const defaultImageUrls = {
                "iceElemental": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/å†°å…ƒç´ .jpg",
                "frostQueen": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/å†°éœœå¥³ç‹.jpg",
                "frostWolf": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/å†°éœœå·¨ç‹¼.jpg",
                "exploration": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/å‹‡æ•¢æ¢ç´¢.jpg",
                "iceSword": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/å¯’å†°ä¹‹åŠ.jpg",
                "mountainKing": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/å±±è„ˆä¹‹ç‹.jpg",
                "forestSword": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ£®æ—ä¹‹åŠ.jpg",
                "forestGuardian": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ£®æ—å®ˆè­·è€….jpg",
                "demonKing": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ¯€æ»…é­”ç‹.jpg",
                "poisonSpider": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ¯’èœ˜è››.jpg",
                "dustDemon": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ²™å¡µæƒ¡é­”.jpg",
                "desertOverlord": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ²™æ¼ éœ¸ä¸».jpg",
                "sandScorpion": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ²™è .jpg",
                "combat": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/æ¿€çƒˆæˆ°é¬¥.jpg",
                "flameDemon": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç«ç„°æƒ¡é­”.jpg",
                "fireLord": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç«ç„°é ˜ä¸».jpg",
                "sunLizard": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/çƒˆæ—¥èœ¥èœ´.jpg",
                "hellKnight": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç…‰ç„é¨å£«.jpg",
                "lavaBeast": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç†”å²©ç¸.jpg",
                "rest": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç‡Ÿç«ä¼‘æ¯.jpg",
                "healthPotion": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç”Ÿå‘½è—¥æ°´.jpg",
                "treasureFound": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç™¼ç¾å¯¶è—.jpg",
                "goldCoins": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç™¼ç¾é‡‘å¹£.jpg",
                "stoneGiant": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/çŸ³å·¨äºº.jpg",
                "levelUp": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç­‰ç´šæå‡.jpg",
                "skillLearned": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/ç¿’å¾—æ–°æŠ€èƒ½.jpg",
                "holyBlade": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/è–å…‰åŠ.jpg",
                "menu": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/éŠæˆ²é–‹å§‹ç•«é¢.jpg",
                "yeti": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/é›ªæ€ª.jpg",
                "snowLeopard": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/é›ªè±¹.png.jpg",
                "stormEagle": "https://raw.githubusercontent.com/Caf555/ForApple/124c96adbdf8ffcb8787899adf64176ad8dbd879/RPG%20JPG/é¢¨æš´é·¹.jpg",
                "victory": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/å‡±æ—‹.jpg",
                "volcano": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/åœ°ç„ç«å±±.jpg",
                "warrior": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/æˆ°å£«è·æ¥­.jpg",
                "forest": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/æ£®æ—.jpg",
                "forestWolf": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/æ£®æ—ç‹¼.jpg",
                "icefield": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/æ¥µå‡å†°åŸ.jpg",
                "mage": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/æ³•å¸«.jpg",
                "desert": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/ç„¦ç†±æ²™æ¼ .jpg",
                "rogue": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/ç›œè³Š.jpg",
                "corruptedTreespirit": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/è…åŒ–æ¨¹ç²¾.jpg",
                "gameOver": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/è‹±é›„éš•è½.jpg",
                "mountain": "https://raw.githubusercontent.com/Caf555/ForApple/d1640533d2a08f16bc7d1ced7101e4f6798c2f07/RPG%20JPG/è’¼ç©¹å±±è„ˆ.jpg"
            };

            // åˆå§‹åŒ–æ™‚è¼‰å…¥é è¨­åœ–ç‰‡
            useEffect(() => {
                const initializeImages = async () => {
                    try {
                        // è¼‰å…¥localStorageä¸­çš„åœ–ç‰‡
                        const savedImages = localStorage.getItem('rpg_uploaded_images');
                        let loadedImages = {};
                        
                        if (savedImages) {
                            loadedImages = JSON.parse(savedImages);
                        }
                        
                        // åˆä½µé è¨­åœ–ç‰‡å’Œç”¨æˆ¶ä¸Šå‚³çš„åœ–ç‰‡ï¼ˆç”¨æˆ¶ä¸Šå‚³çš„å„ªå…ˆï¼‰
                        const finalImages = { ...defaultImageUrls, ...loadedImages };
                        
                        setUploadedImages(finalImages);
                        
                        // è¼‰å…¥é¡¯ç¤ºè¨­ç½®
                        const savedDisplayMode = localStorage.getItem('rpg_image_display_mode');
                        if (savedDisplayMode) {
                            setImageDisplayMode(savedDisplayMode);
                        }
                        
                        setIsLoading(false);
                    } catch (error) {
                        console.warn('åˆå§‹åŒ–åœ–ç‰‡å¤±æ•—:', error);
                        setUploadedImages(defaultImageUrls);
                        setIsLoading(false);
                    }
                };
                
                initializeImages();
            }, []);

            // ä¿å­˜é¡¯ç¤ºæ¨¡å¼åˆ°localStorage
            useEffect(() => {
                try {
                    localStorage.setItem('rpg_image_display_mode', imageDisplayMode);
                } catch (error) {
                    console.warn('ä¿å­˜è¨­ç½®å¤±æ•—:', error);
                }
            }, [imageDisplayMode]);

            // ä¿å­˜åœ–ç‰‡åˆ°localStorage
            const saveImagesToStorage = useCallback((images) => {
                try {
                    // åªä¿å­˜ç”¨æˆ¶ä¸Šå‚³çš„åœ–ç‰‡ï¼Œä¸ä¿å­˜é è¨­åœ–ç‰‡
                    const userImages = {};
                    Object.entries(images).forEach(([key, url]) => {
                        if (!defaultImageUrls[key] || url !== defaultImageUrls[key]) {
                            userImages[key] = url;
                        }
                    });
                    localStorage.setItem('rpg_uploaded_images', JSON.stringify(userImages));
                } catch (error) {
                    console.warn('ä¿å­˜åœ–ç‰‡å¤±æ•—:', error);
                    alert('âš ï¸ åœ–ç‰‡ä¿å­˜å¤±æ•—ï¼Œå¯èƒ½æ˜¯å„²å­˜ç©ºé–“ä¸è¶³');
                }
            }, []);

            const [player, setPlayer] = useState({
                name: '',
                class: null,
                level: 1,
                hp: 100,
                maxHp: 100,
                mp: 50,
                maxMp: 50,
                attack: 20,
                defense: 10,
                speed: 15,
                luck: 10,
                exp: 0,
                gold: 100,
                skillPoints: 0,
                inventory: [],
                equipment: {
                    weapon: null,
                    armor: null,
                    accessory: null
                },
                skills: {},
                statusEffects: [],
                stats: {
                    enemiesDefeated: 0,
                    areasCleared: 0,
                    treasuresFound: 0,
                    goldEarned: 0
                }
            });
            const [currentArea, setCurrentArea] = useState(0);
            const [battleState, setBattleState] = useState(null);
            const [gameLog, setGameLog] = useState([]);
            const [gameTime, setGameTime] = useState(0);
            const [lastAction, setLastAction] = useState(null);
            const [activeTab, setActiveTab] = useState('inventory');
            const [combatAnimations, setCombatAnimations] = useState([]);

            // ğŸ¬ å®Œæ•´AIåœ–ç‰‡æç¤ºè©æ•¸æ“šåº« - é›»å½±ç´šæ©«å‘æ§‹åœ–ç³»çµ±
            const imagePrompts = {
                // éŠæˆ²ç‹€æ…‹ - å²è©©ç´šé–‹å ´
                menu: {
                    title: "éŠæˆ²é–‹å§‹ç•«é¢",
                    prompt: "Epic fantasy game title screen, majestic castle silhouette against golden sunset, floating islands in distance, magical aurora in sky, ancient runes glowing in foreground, JRPG cinematic opening, anime art style, grandiose and inspiring, aspect ratio 16:9, ultra-wide cinematic composition, depth of field, lens flare effects"
                },
                victory: {
                    title: "å‹åˆ©æ¦®è€€",
                    prompt: "Hero standing triumphant on battlefield overlooking conquered demon realm, legendary sword planted in ground, cape billowing dramatically, golden light breaking through storm clouds, fallen enemies scattered, victory banners in wind, epic JRPG ending scene, anime art style, aspect ratio 16:9, cinematic wide shot, dramatic lighting"
                },
                gameOver: {
                    title: "è‹±é›„éš•è½",
                    prompt: "Melancholic battlefield at dusk, broken weapons scattered, hero's spirit ascending as ethereal light, dark storm clouds parting to reveal stars, sorrowful but beautiful scene, cherry blossoms falling like snow, JRPG tragic ending, anime art style, aspect ratio 16:9, atmospheric wide composition, emotional depth"
                },

                // è·æ¥­å ´æ™¯ - å‹•ä½œå°å‘çš„æ©«å‘æ§‹åœ–
                warrior: {
                    title: "æˆ°å£«è·æ¥­",
                    prompt: "Mighty warrior in epic battle stance on ancient battlefield, gleaming plate armor reflecting sunset, massive sword raised, enemy army approaching in distance, war banners flying, sparks from clashing weapons, JRPG hero scene, anime art style, aspect ratio 16:9, dynamic action composition, heroic atmosphere"
                },
                mage: {
                    title: "æ³•å¸«è·æ¥­", 
                    prompt: "Wise mage casting powerful spell in mystical tower library, magical energy swirling around, floating ancient tomes, arcane circles glowing on floor, starry sky visible through tall windows, JRPG magic scene, anime art style, aspect ratio 16:9, wide magical environment, ethereal lighting effects"
                },
                rogue: {
                    title: "ç›œè³Šè·æ¥­",
                    prompt: "Agile rogue infiltrating moonlit castle rooftops, dual daggers gleaming, flowing cloak in night wind, city lights below, shadows and stealth, leaping between buildings, JRPG stealth scene, anime art style, aspect ratio 16:9, dynamic parkour composition, atmospheric night setting"
                },

                // å€åŸŸå ´æ™¯ - æ²‰æµ¸å¼ç’°å¢ƒæ•˜äº‹
                forest: {
                    title: "è¿·éœ§æ£®æ—",
                    prompt: "Ancient mystical forest path winding through towering trees, ethereal mist dancing between trunks, glowing mushrooms and fireflies, shafts of golden sunlight piercing canopy, hidden ruins glimpsed in distance, JRPG exploration scene, anime environment art, aspect ratio 16:9, immersive forest vista, magical atmosphere"
                },
                mountain: {
                    title: "è’¼ç©¹å±±è„ˆ",
                    prompt: "Breathtaking mountain pass with snow-capped peaks reaching into clouds, ancient stone bridge spanning chasm, aurora borealis painting sky, crystal formations reflecting light, eagle soaring overhead, JRPG mountain journey, anime landscape art, aspect ratio 16:9, epic mountain panorama, majestic scale"
                },
                desert: {
                    title: "ç„¦ç†±æ²™æ¼ ",
                    prompt: "Vast desert expedition with ancient pyramid rising from golden dunes, caravan silhouettes on horizon, heat mirages shimmering, twin suns in dramatic sky, buried ruins emerging from sand, JRPG desert adventure, anime environment art, aspect ratio 16:9, sweeping desert landscape, adventure atmosphere"
                },
                icefield: {
                    title: "æ¥µå‡å†°åŸ",
                    prompt: "Frozen tundra expedition with massive ice formations, northern lights dancing in starry sky, dog sled team crossing endless white plains, distant ice palace glowing blue, ice crystals sparkling like diamonds, JRPG arctic journey, anime art style, aspect ratio 16:9, vast frozen wilderness, ethereal beauty"
                },
                volcano: {
                    title: "åœ°ç„ç«å±±",
                    prompt: "Treacherous volcanic landscape with lava rivers flowing between obsidian cliffs, massive volcanic eruption in background, fire demons lurking in shadows, glowing embers floating in air, hellish red sky, JRPG infernal realm, anime dark fantasy art, aspect ratio 16:9, dramatic volcanic vista, intense atmosphere"
                },

                // æ£®æ—å€åŸŸæ•µäººå’ŒBOSS
                forestWolf: {
                    title: "æ£®æ—ç‹¼",
                    prompt: "Fierce wolf pack emerging from misty forest shadows, glowing red eyes in darkness, hero drawing sword in defensive stance, moonlight filtering through trees, tension before battle, JRPG encounter scene, anime art style, aspect ratio 16:9, dramatic confrontation composition, suspenseful atmosphere"
                },
                corruptedTreespirit: {
                    title: "è…åŒ–æ¨¹ç²¾",
                    prompt: "Massive corrupted treant boss battle in twisted forest clearing, gnarled branches reaching like claws, dark magic swirling around, hero casting spell in foreground, corrupted nature all around, JRPG boss fight scene, anime art style, aspect ratio 16:9, epic boss encounter, dark magical atmosphere"
                },
                poisonSpider: {
                    title: "æ¯’èœ˜è››",
                    prompt: "Giant spider ambush in web-covered cave tunnel, hero with torch illuminating massive arachnid, purple venom dripping, multiple glowing eyes reflecting light, escape route behind, JRPG dungeon encounter, anime art style, aspect ratio 16:9, claustrophobic tunnel composition, creepy atmosphere"
                },
                forestGuardian: {
                    title: "æ£®æ—å®ˆè­·è€…",
                    prompt: "Epic boss battle against colossal forest guardian in sacred grove, ancient treant with glowing moss armor, nature magic filling air, hero tiny in comparison, forest spirits watching from trees, JRPG legendary boss fight, anime art style, aspect ratio 16:9, scale comparison composition, mythical atmosphere"
                },

                // å±±è„ˆå€åŸŸæ•µäººå’ŒBOSS
                snowLeopard: {
                    title: "é›ªè±¹",
                    prompt: "Fierce snow leopard leaping across icy mountain ledges, hero dodging with ice axe, dramatic mountain cliffs in background, snowstorm swirling around, dangerous alpine encounter, JRPG mountain battle, anime art style, aspect ratio 16:9, dynamic leap composition, harsh mountain environment"
                },
                stoneGiant: {
                    title: "çŸ³å·¨äºº",
                    prompt: "Massive stone golem awakening in mountain quarry, boulder-sized fists raised, hero taking cover behind rocks, avalanche starting in distance, ancient runes glowing on giant's body, JRPG colossus battle, anime art style, aspect ratio 16:9, intimidating scale composition, rocky mountain setting"
                },
                stormEagle: {
                    title: "é¢¨æš´é·¹",
                    prompt: "Giant eagle dive-bombing from stormy mountain peaks, hero shooting arrows while hanging from cliff, lightning crackling through dark clouds, fierce winds whipping snow, aerial combat scene, JRPG sky battle, anime art style, aspect ratio 16:9, vertical action composition, tempestuous atmosphere"
                },
                mountainKing: {
                    title: "å±±è„ˆä¹‹ç‹",
                    prompt: "Colossal mountain titan emerging from snow-covered peak, hero standing on narrow ledge facing the giant, ice crown on titan's head, avalanche cascading around, epic scale confrontation, JRPG mountain boss fight, anime art style, aspect ratio 16:9, overwhelming size comparison, majestic mountain backdrop"
                },

                // æ²™æ¼ å€åŸŸæ•µäººå’ŒBOSS
                sandScorpion: {
                    title: "æ²™è ",
                    prompt: "Giant scorpion bursting from desert dunes, hero leaping away from poisonous stinger, sand exploding everywhere, desert sun casting harsh shadows, deadly desert encounter, JRPG desert battle, anime art style, aspect ratio 16:9, explosive emergence composition, arid wasteland setting"
                },
                dustDemon: {
                    title: "æ²™å¡µæƒ¡é­”",
                    prompt: "Demonic entity made of swirling sand confronting hero in desert storm, glowing red eyes in sandstorm, hero's cloak whipping in supernatural winds, ancient desert ruins in background, supernatural desert encounter, JRPG demon battle, anime art style, aspect ratio 16:9, supernatural wind composition, mystical desert atmosphere"
                },
                sunLizard: {
                    title: "çƒˆæ—¥èœ¥èœ´",
                    prompt: "Large fire-breathing lizard camouflaged against desert rocks, hero surprised by flame attack, crystalline formations reflecting sunlight, heat waves distorting air, blazing desert battle, JRPG fire monster encounter, anime art style, aspect ratio 16:9, heat distortion composition, scorching desert environment"
                },
                desertOverlord: {
                    title: "æ²™æ¼ éœ¸ä¸»",
                    prompt: "Gigantic sand worm erupting from desert floor, hero riding magical carpet above, ancient pyramid crumbling in background, sandstorm spiraling around the worm, epic desert boss battle, JRPG legendary encounter, anime art style, aspect ratio 16:9, massive eruption composition, legendary desert setting"
                },

                // å†°åŸå€åŸŸæ•µäººå’ŒBOSS
                frostWolf: {
                    title: "å†°éœœå·¨ç‹¼",
                    prompt: "Massive white wolf with ice crystals forming on its fur, hero wielding fire sword against the cold, blizzard raging around them, northern lights in background, frozen wilderness battle, JRPG ice wolf encounter, anime art style, aspect ratio 16:9, cold elemental composition, arctic battlefield"
                },
                iceElemental: {
                    title: "å†°å…ƒç´ ",
                    prompt: "Crystalline ice elemental forming from frozen lake, hero casting fire magic, ice shards flying through air, frozen waterfall in background, magical ice battle, JRPG elemental encounter, anime art style, aspect ratio 16:9, crystal formation composition, magical frozen landscape"
                },
                yeti: {
                    title: "é›ªæ€ª",
                    prompt: "Towering yeti roaring in snowy mountain cave, hero with torch illuminating the beast, icicles hanging like teeth, snow swirling at cave entrance, legendary creature encounter, JRPG monster battle, anime art style, aspect ratio 16:9, cave intimidation composition, mysterious arctic cave"
                },
                frostQueen: {
                    title: "å†°éœœå¥³ç‹",
                    prompt: "Ethereal ice queen on throne of frozen crystal, hero approaching through ice palace, magical ice powers swirling around, aurora borealis visible through ice windows, majestic final ice boss, JRPG royal boss battle, anime art style, aspect ratio 16:9, throne room grandeur composition, magical ice palace"
                },

                // ç«å±±å€åŸŸæ•µäººå’ŒBOSS
                lavaBeast: {
                    title: "ç†”å²©ç¸",
                    prompt: "Molten rock creature emerging from lava pool, hero dodging with water magic, volcanic eruption in background, lava flows creating dangerous terrain, intense heat battle, JRPG fire monster encounter, anime art style, aspect ratio 16:9, molten emergence composition, volcanic hellscape"
                },
                flameDemon: {
                    title: "ç«ç„°æƒ¡é­”",
                    prompt: "Demonic entity wreathed in hellfire confronting hero, flames dancing around both combatants, obsidian pillars and lava rivers, ash falling like snow, supernatural fire battle, JRPG demon encounter, anime art style, aspect ratio 16:9, hellfire confrontation composition, infernal realm atmosphere"
                },
                hellKnight: {
                    title: "ç…‰ç„é¨å£«",
                    prompt: "Armored knight riding flaming skeletal horse, hero standing ground with holy sword, volcanic battlefield with lava geysers, dark smoke filling sky, epic mounted combat, JRPG hell knight battle, anime art style, aspect ratio 16:9, mounted charge composition, apocalyptic volcanic setting"
                },
                fireLord: {
                    title: "ç«ç„°é ˜ä¸»",
                    prompt: "Massive fire deity on volcanic throne, hero wielding ice magic, lava flowing like waterfalls, volcanic palace crumbling from heat, legendary fire boss battle, JRPG elemental lord fight, anime art style, aspect ratio 16:9, divine confrontation composition, ultimate volcanic arena"
                },

                // æœ€çµ‚BOSS
                demonKing: {
                    title: "æ¯€æ»…é­”ç‹",
                    prompt: "Final boss confrontation in crumbling demon castle throne room, massive demon lord with dark wings spread, hero approaching with holy sword glowing, throne of skulls cracking, apocalyptic battle beginning, JRPG ultimate showdown, anime dark fantasy art, aspect ratio 16:9, epic final battle composition, dramatic tension"
                },

                // ç‰©å“ç™¼ç¾ - æ©«å‘æ•˜äº‹å ´æ™¯
                goldCoins: {
                    title: "ç™¼ç¾é‡‘å¹£",
                    prompt: "Hero discovering treasure cache in hidden cave chamber, golden coins spilling from ancient chest, magical sparkles in air, cave paintings on walls telling old stories, adventure reward moment, JRPG treasure discovery, anime art style, aspect ratio 16:9, treasure chamber vista, rewarding atmosphere"
                },
                forestSword: {
                    title: "æ£®æ—ä¹‹åŠ",
                    prompt: "Legendary elven blade found in sacred forest shrine, sword glowing with nature magic, ancient stone altar surrounded by mystical trees, hero reaching for weapon, destiny moment, JRPG weapon acquisition, anime fantasy art, aspect ratio 16:9, shrine discovery scene, magical significance"
                },
                healthPotion: {
                    title: "ç”Ÿå‘½è—¥æ°´",
                    prompt: "Alchemist's workshop with glowing healing potions on shelves, magical herbs hanging from ceiling, cauldron bubbling with red elixir, mystical laboratory atmosphere, potion crafting scene, JRPG item creation, anime art style, aspect ratio 16:9, magical workshop interior, mysterious alchemy"
                },
                iceSword: {
                    title: "å¯’å†°ä¹‹åŠ",
                    prompt: "Ice blade discovered in frozen crystal cavern, sword emanating cold mist, ice formations reacting to its power, hero in winter gear reaching for weapon, arctic exploration reward, JRPG ice weapon scene, anime fantasy art, aspect ratio 16:9, frozen cavern discovery, elemental power"
                },
                holyBlade: {
                    title: "è–å…‰åŠ",
                    prompt: "Divine sword descending from heavenly light in ancient temple, golden rays piercing through divine architecture, hero kneeling in reverence, angelic symbols glowing on walls, ultimate weapon blessing, JRPG holy weapon scene, anime divine art, aspect ratio 16:9, temple sanctum vista, divine blessing"
                },

                // ç‰¹æ®Šå ´æ™¯ - é›»å½±ç´šæ©«å‘æ§‹åœ–
                combat: {
                    title: "æ¿€çƒˆæˆ°é¬¥",
                    prompt: "Epic multi-enemy battle in crumbling arena, hero fighting multiple monsters simultaneously, magical explosions and weapon clashes, dynamic action lines, debris flying through air, JRPG intense combat, anime fighting scene, aspect ratio 16:9, wide battle arena, explosive action"
                },
                levelUp: {
                    title: "ç­‰ç´šæå‡",
                    prompt: "Hero achieving new power level on mountain summit, golden aura expanding across landscape, levitation with energy spiraling around body, distant kingdoms visible below, power awakening moment, JRPG character growth, anime art style, aspect ratio 16:9, mountain top transformation, transcendent power"
                },
                skillLearned: {
                    title: "ç¿’å¾—æ–°æŠ€èƒ½",
                    prompt: "Ancient sage teaching hero new magic in mystical training ground, magical symbols appearing in air, knowledge transferring as glowing energy, sacred learning environment, master and student scene, JRPG skill training, anime art style, aspect ratio 16:9, training ground vista, wisdom transfer"
                },
                treasureFound: {
                    title: "ç™¼ç¾å¯¶è—",
                    prompt: "Massive treasure vault discovery with gold and gems everywhere, hero standing amazed at entrance, magical lighting revealing incredible wealth, ancient vault architecture, ultimate treasure find, JRPG treasure room, anime art style, aspect ratio 16:9, vast treasure vault, overwhelming riches"
                },
                exploration: {
                    title: "å‹‡æ•¢æ¢ç´¢",
                    prompt: "Hero's journey across diverse fantasy landscapes, winding path leading through multiple biomes, adventure supplies packed, sense of endless possibility ahead, exploration montage scene, JRPG adventure beginning, anime journey art, aspect ratio 16:9, adventure path vista, limitless exploration"
                },
                rest: {
                    title: "ç‡Ÿç«ä¼‘æ¯",
                    prompt: "Peaceful camping scene under star-filled sky, hero resting by warm campfire, adventure gear arranged nearby, gentle night sounds and fireflies, moment of tranquil respite during journey, JRPG rest scene, anime slice of life art, aspect ratio 16:9, campsite under stars, peaceful night"
                }
            };

            // è·æ¥­ç³»çµ±
            const classes = {
                warrior: {
                    name: "æˆ°å£«",
                    emoji: "âš”ï¸",
                    description: "è¿‘æˆ°å°ˆå®¶ï¼Œé«˜æ”»æ“Šå’Œé˜²ç¦¦åŠ›",
                    bonuses: { attack: 10, defense: 8, hp: 30 },
                    skills: ["é‡æ“Š", "é˜²ç¦¦å§¿æ…‹", "æˆ°å¼", "ç‹‚æš´"]
                },
                mage: {
                    name: "æ³•å¸«", 
                    emoji: "ğŸ”®",
                    description: "é­”æ³•ä½¿ç”¨è€…ï¼Œé«˜é­”åŠ›å’ŒæŠ€èƒ½å‚·å®³",
                    bonuses: { attack: 5, defense: 3, mp: 30, luck: 5 },
                    skills: ["ç«çƒè¡“", "æ²»ç™‚è¡“", "å†°ç®­", "é­”æ³•è­·ç›¾"]
                },
                rogue: {
                    name: "ç›œè³Š",
                    emoji: "ğŸ—¡ï¸", 
                    description: "æ•æ·åˆºå®¢ï¼Œé«˜æš´æ“Šå’Œé€Ÿåº¦",
                    bonuses: { attack: 8, speed: 10, luck: 8 },
                    skills: ["èƒŒåˆº", "é–ƒé¿", "æ¯’åˆƒ", "éš±èº«"]
                }
            };

            // æŠ€èƒ½æ•¸æ“šåº«
            const skillDatabase = {
                é‡æ“Š: { mp: 15, damage: 1.8, description: "å¼·åŠ›æ”»æ“Šï¼Œé€ æˆ180%å‚·å®³" },
                é˜²ç¦¦å§¿æ…‹: { mp: 10, defense: 2, duration: 3, description: "3å›åˆå…§é˜²ç¦¦ç¿»å€" },
                æˆ°å¼: { mp: 12, description: "éœ‡æ‡¾æ•µäºº" },
                ç‹‚æš´: { mp: 20, attack: 1.5, duration: 4, description: "4å›åˆå…§æ”»æ“Šæå‡50%" },
                
                ç«çƒè¡“: { mp: 12, damage: 2.0, description: "ç«ç„°é­”æ³•æ”»æ“Š" },
                æ²»ç™‚è¡“: { mp: 15, heal: 0.5, description: "æ¢å¾©50%è¡€é‡" },
                å†°ç®­: { mp: 10, damage: 1.3, description: "å†°ç³»æ”»æ“Š" },
                é­”æ³•è­·ç›¾: { mp: 18, shield: 0.3, duration: 5, description: "é­”æ³•è­·ç›¾" },
                
                èƒŒåˆº: { mp: 10, damage: 2.2, crit: 0.8, description: "é«˜æš´æ“Šæ”»æ“Š" },
                é–ƒé¿: { mp: 8, dodge: 0.7, duration: 2, description: "æå‡é–ƒé¿ç‡" },
                æ¯’åˆƒ: { mp: 14, damage: 1.1, poison: 3, description: "æ¯’æ€§æ”»æ“Š" },
                éš±èº«: { mp: 16, stealth: 3, description: "éš±èº«ç‹€æ…‹" }
            };

            // å€åŸŸæ•¸æ“š
            const areas = [
                {
                    name: "è¿·éœ§æ£®æ—",
                    description: "å¤è€æ£®æ—è¢«ç¥ç§˜è¿·éœ§ç± ç½©...",
                    emoji: "ğŸŒ²",
                    imageKey: "forest",
                    enemies: [
                        { name: "æ£®æ—ç‹¼", hp: 60, attack: 18, defense: 5, exp: 25, gold: 15, imageKey: "forestWolf" },
                        { name: "è…åŒ–æ¨¹ç²¾", hp: 90, attack: 15, defense: 12, exp: 35, gold: 20, imageKey: "corruptedTreespirit" },
                        { name: "æ¯’èœ˜è››", hp: 45, attack: 12, defense: 3, exp: 20, gold: 12, imageKey: "poisonSpider" }
                    ],
                    boss: { name: "æ£®æ—å®ˆè­·è€…", hp: 200, attack: 25, defense: 15, exp: 100, gold: 80, imageKey: "forestGuardian" },
                    treasures: [
                        { name: "æ£®æ—ä¹‹åŠ", type: "weapon", attack: 8, value: 150, imageKey: "forestSword" },
                        { name: "ç”Ÿå‘½è—¥æ°´", type: "potion", heal: 60, value: 30, imageKey: "healthPotion" },
                        { name: "é€Ÿåº¦ä¹‹é´", type: "accessory", speed: 5, value: 100 }
                    ]
                },
                {
                    name: "è’¼ç©¹å±±è„ˆ", 
                    description: "éšªå³»çš„é›ªå±±ç›´æ’é›²éœ„...",
                    emoji: "â›°ï¸",
                    imageKey: "mountain",
                    enemies: [
                        { name: "é›ªè±¹", hp: 75, attack: 22, defense: 8, exp: 30, gold: 18, imageKey: "snowLeopard" },
                        { name: "çŸ³å·¨äºº", hp: 120, attack: 28, defense: 20, exp: 45, gold: 25, imageKey: "stoneGiant" },
                        { name: "é¢¨æš´é·¹", hp: 65, attack: 20, defense: 6, exp: 28, gold: 22, imageKey: "stormEagle" }
                    ],
                    boss: { name: "å±±è„ˆä¹‹ç‹", hp: 280, attack: 32, defense: 25, exp: 120, gold: 100, imageKey: "mountainKing" },
                    treasures: [
                        { name: "å¯’å†°ä¹‹åŠ", type: "weapon", attack: 12, value: 200, imageKey: "iceSword" },
                        { name: "é±—ç”²", type: "armor", defense: 12, value: 180 },
                        { name: "é­”åŠ›è—¥æ°´", type: "potion", mp: 40, value: 35 }
                    ]
                },
                {
                    name: "ç„¦ç†±æ²™æ¼ ",
                    description: "ç„¡ç›¡æ²™æµ·åœ¨çƒˆæ—¥ä¸‹é–ƒçˆ...",
                    emoji: "ğŸœï¸",
                    imageKey: "desert",
                    enemies: [
                        { name: "æ²™è ", hp: 80, attack: 26, defense: 10, exp: 35, gold: 20, imageKey: "sandScorpion" },
                        { name: "æ²™å¡µæƒ¡é­”", hp: 100, attack: 30, defense: 8, exp: 50, gold: 30, imageKey: "dustDemon" },
                        { name: "çƒˆæ—¥èœ¥èœ´", hp: 70, attack: 24, defense: 15, exp: 32, gold: 25, imageKey: "sunLizard" }
                    ],
                    boss: { name: "æ²™æ¼ éœ¸ä¸»", hp: 350, attack: 38, defense: 20, exp: 150, gold: 120, imageKey: "desertOverlord" },
                    treasures: [
                        { name: "çƒˆç„°ä¹‹åŠ", type: "weapon", attack: 16, value: 300 },
                        { name: "æ²™æ¼ æ–—ç¯·", type: "armor", defense: 10, value: 220 },
                        { name: "å…¨å¾©è—¥æ°´", type: "potion", heal: 100, value: 50 }
                    ]
                },
                {
                    name: "æ¥µå‡å†°åŸ",
                    description: "æ°¸æ†çš„å†°é›ªä¸–ç•Œ...",
                    emoji: "ğŸ§Š",
                    imageKey: "icefield",
                    enemies: [
                        { name: "å†°éœœå·¨ç‹¼", hp: 110, attack: 32, defense: 12, exp: 40, gold: 28, imageKey: "frostWolf" },
                        { name: "å†°å…ƒç´ ", hp: 130, attack: 35, defense: 25, exp: 55, gold: 35, imageKey: "iceElemental" },
                        { name: "é›ªæ€ª", hp: 140, attack: 28, defense: 18, exp: 48, gold: 32, imageKey: "yeti" }
                    ],
                    boss: { name: "å†°éœœå¥³ç‹", hp: 420, attack: 42, defense: 30, exp: 180, gold: 150, imageKey: "frostQueen" },
                    treasures: [
                        { name: "éœœæœˆä¹‹åŠ", type: "weapon", attack: 20, value: 400 },
                        { name: "é¾é±—ç”²", type: "armor", defense: 18, value: 350 },
                        { name: "ç¥è–è—¥æ°´", type: "potion", heal: 150, value: 80 }
                    ]
                },
                {
                    name: "åœ°ç„ç«å±±",
                    description: "å²©æ¼¿æ²³æµæ·Œè‘—æ­»äº¡...",
                    emoji: "ğŸŒ‹",
                    imageKey: "volcano",
                    enemies: [
                        { name: "ç†”å²©ç¸", hp: 120, attack: 36, defense: 15, exp: 45, gold: 30, imageKey: "lavaBeast" },
                        { name: "ç«ç„°æƒ¡é­”", hp: 150, attack: 40, defense: 12, exp: 60, gold: 40, imageKey: "flameDemon" },
                        { name: "ç…‰ç„é¨å£«", hp: 160, attack: 38, defense: 22, exp: 65, gold: 45, imageKey: "hellKnight" }
                    ],
                    boss: { name: "ç«ç„°é ˜ä¸»", hp: 500, attack: 45, defense: 25, exp: 200, gold: 180, imageKey: "fireLord" },
                    treasures: [
                        { name: "è–å…‰åŠ", type: "weapon", attack: 25, value: 600, imageKey: "holyBlade" },
                        { name: "ç†¾å¤©ä½¿è­·ç”²", type: "armor", defense: 25, value: 500 },
                        { name: "ç”Ÿå‘½è–æ³‰", type: "potion", heal: 200, value: 150 }
                    ]
                }
            ];

            const demonKing = {
                name: "æ¯€æ»…é­”ç‹",
                hp: 800,
                maxHp: 800,
                attack: 55,
                defense: 30,
                exp: 500,
                gold: 1000,
                imageKey: "demonKing"
            };

            // è¨­ç½®åœ–ç‰‡å‡½æ•¸
            const setImage = useCallback((imageKey) => {
                const imageData = imagePrompts[imageKey];
                if (imageData) {
                    setCurrentImage({
                        title: imageData.title,
                        prompt: imageData.prompt,
                        imageUrl: uploadedImages[imageKey] || ''
                    });
                }
            }, [uploadedImages]);

            // è™•ç†åœ–ç‰‡ä¸Šå‚³
            const handleImageUpload = useCallback((imageKey, file) => {
                if (file && file.type.startsWith('image/')) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('âŒ åœ–ç‰‡æª”æ¡ˆéå¤§ï¼Œè«‹é¸æ“‡å°æ–¼5MBçš„åœ–ç‰‡');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const newImages = {
                            ...uploadedImages,
                            [imageKey]: e.target.result
                        };
                        
                        setUploadedImages(newImages);
                        saveImagesToStorage(newImages);
                        
                        if (currentImage.title === imagePrompts[imageKey]?.title) {
                            setCurrentImage(prev => ({
                                ...prev,
                                imageUrl: e.target.result
                            }));
                        }
                        setShowImageUpload(false);
                        alert('âœ… åœ–ç‰‡ä¸Šå‚³ä¸¦æ°¸ä¹…ä¿å­˜æˆåŠŸï¼');
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('âŒ è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–ç‰‡æª”æ¡ˆ (JPG, PNG, GIF)');
                }
            }, [uploadedImages, currentImage.title, saveImagesToStorage]);

            // è™•ç†URLåœ–ç‰‡
            const handleImageUrl = useCallback((imageKey, url) => {
                if (!url.trim()) {
                    alert('âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„åœ–ç‰‡URL');
                    return;
                }

                try {
                    new URL(url);
                } catch {
                    alert('âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„URLæ ¼å¼');
                    return;
                }

                const newImages = {
                    ...uploadedImages,
                    [imageKey]: url
                };
                
                setUploadedImages(newImages);
                saveImagesToStorage(newImages);
                
                if (currentImage.title === imagePrompts[imageKey]?.title) {
                    setCurrentImage(prev => ({
                        ...prev,
                        imageUrl: url
                    }));
                }
                setShowImageUpload(false);
                alert('âœ… åœ–ç‰‡URLå·²ä¿å­˜æˆåŠŸï¼');
            }, [uploadedImages, currentImage.title, saveImagesToStorage]);

            // å·¥å…·å‡½æ•¸
            const addLog = useCallback((message, type = "normal") => {
                setGameLog(prev => [...prev.slice(-7), { 
                    message, 
                    type, 
                    timestamp: new Date().toLocaleTimeString() 
                }]);
            }, []);

            const addCombatAnimation = useCallback((text, type = "damage") => {
                const id = Date.now() + Math.random();
                setCombatAnimations(prev => [...prev, { id, text, type }]);
                
                if (type === 'damage' || type === 'critical' || type === 'enemy_damage') {
                    setLastAction('combat_action');
                    setTimeout(() => setLastAction(null), 700);
                }
                
                setTimeout(() => {
                    setCombatAnimations(prev => prev.filter(anim => anim.id !== id));
                }, 2000);
            }, []);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            // éŠæˆ²æ™‚é–“è¨ˆæ™‚å™¨
            useEffect(() => {
                if (gameState === 'playing') {
                    const timer = setInterval(() => {
                        setGameTime(prev => prev + 1);
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gameState]);

            // åœ–ç‰‡è¨­ç½®æ•ˆæœ
            useEffect(() => {
                if (gameState === 'menu' || gameState === 'gallery') {
                    setImage('menu');
                } else if (gameState === 'character_creation' && selectedClass) {
                    setImage(selectedClass);
                } else if (gameState === 'victory') {
                    setImage('victory');
                } else if (gameState === 'gameOver') {
                    setImage('gameOver');
                } else if (gameState === 'playing' && !battleState) {
                    if (currentArea < areas.length) {
                        setImage(areas[currentArea].imageKey);
                    }
                }
            }, [gameState, currentArea, battleState, selectedClass, setImage]);

            // åœ–ç‰‡é¡¯ç¤ºçµ„ä»¶
            const ImageDisplay = () => {
                return (
                    <div className="image-container">
                        {currentImage.imageUrl ? (
                            <img 
                                src={currentImage.imageUrl} 
                                alt={currentImage.title}
                                style={{
                                    width: '100%',
                                    height: '100%',
                                    borderRadius: '10px',
                                    objectFit: imageDisplayMode === 'fill' ? 'fill' : 
                                              imageDisplayMode === 'contain' ? 'contain' : 'cover',
                                    transition: 'filter 0.5s ease'
                                }}
                                className="image-gentle-transition"
                            />
                        ) : (
                            <div className="image-placeholder">
                                <div className="image-placeholder-icon">ğŸ¨</div>
                                <div style={{ fontSize: '0.9rem', textAlign: 'center', padding: '0 1rem' }}>
                                    {currentImage.title || 'AIåœ–ç‰‡é¡¯ç¤ºå€åŸŸ'}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // é€²åº¦æ¢çµ„ä»¶
            const ProgressBar = ({ label, current, max, color, emoji }) => (
                <div className="progress-container">
                    <span style={{ fontSize: '0.8rem', minWidth: '40px' }}>{emoji}</span>
                    <div className="progress-bar">
                        <div 
                            className="progress-fill"
                            style={{ 
                                width: `${(current / max) * 100}%`,
                                background: color
                            }}
                        />
                    </div>
                    <span style={{ fontSize: '0.8rem', minWidth: '60px' }}>{current}/{max}</span>
                </div>
            );

            // è¼‰å…¥ç•«é¢
            if (isLoading) {
                return (
                    <div className="loading-overlay">
                        <div style={{ textAlign: 'center' }}>
                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>âš”ï¸</div>
                            <div style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>å‹‡è€…å‚³èªªï¼šäº”åŸŸå¾é€”</div>
                            <div style={{ fontSize: '1rem', color: '#9ca3af' }}>æ­£åœ¨è¼‰å…¥å®Œæ•´åœ–ç‰‡åº«...</div>
                            <div style={{ fontSize: '0.8rem', color: '#6b7280', marginTop: '0.5rem' }}>
                                åŒ…å«43å¼µAIç”Ÿæˆåœ–ç‰‡
                            </div>
                        </div>
                    </div>
                );
            }

            // ä¸»é¸å–®
            if (gameState === 'menu') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '600px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ 
                                fontSize: '2.5rem', 
                                fontWeight: 'bold', 
                                marginBottom: '1rem', 
                                color: '#fbbf24'
                            }}>
                                âš”ï¸ å‹‡è€…å‚³èªª âš”ï¸
                            </h1>
                            <h2 style={{ 
                                fontSize: '1.2rem', 
                                marginBottom: '2rem', 
                                color: '#60a5fa'
                            }}>
                                äº”åŸŸå¾é€” - å®Œæ•´åœ–ç‰‡ç‰ˆ
                            </h2>
                            
                            <ImageDisplay />
                            
                            <div className="game-card" style={{ padding: '1.5rem', marginBottom: '2rem' }}>
                                <p style={{ fontSize: '1rem', marginBottom: '2rem' }}>
                                    ğŸ¬ æ­¡è¿ä¾†åˆ°å®Œæ•´åœ–ç‰‡ç‰ˆçš„é­”æ³•å†’éšªä¸–ç•Œï¼
                                </p>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', alignItems: 'center' }}>
                                    <button
                                        onClick={() => setGameState('character_creation')}
                                        className="btn btn-primary"
                                        style={{ 
                                            fontSize: '1.1rem',
                                            padding: '1rem 2rem',
                                            minWidth: '250px'
                                        }}
                                    >
                                        ğŸš€ é–‹å§‹éŠæˆ²
                                    </button>
                                    
                                    <button
                                        onClick={() => setGameState('gallery')}
                                        className="btn btn-secondary"
                                        style={{ 
                                            fontSize: '1rem',
                                            padding: '0.75rem 2rem',
                                            minWidth: '250px'
                                        }}
                                    >
                                        ğŸ–¼ï¸ åœ–ç‰‡ç®¡ç†ä¸­å¿ƒ
                                    </button>
                                </div>
                                
                                <div style={{ 
                                    marginTop: '1.5rem', 
                                    fontSize: '0.8rem', 
                                    color: '#9ca3af',
                                    lineHeight: '1.4' 
                                }}>
                                    ğŸ¯ <strong>å®Œæ•´åœ–ç‰‡ç‰ˆç‰¹è‰²ï¼š</strong><br/>
                                    ğŸ–¼ï¸ å…§å»º43å¼µAIç”Ÿæˆçš„ç²¾ç¾åœ–ç‰‡<br/>
                                    ğŸ¬ é›»å½±ç´š16:9æ©«å‘æ§‹åœ–è¨­è¨ˆ<br/>
                                    âš”ï¸ åŒ…å«æ‰€æœ‰è·æ¥­ã€å€åŸŸã€æ•µäººå’Œç‰©å“åœ–ç‰‡<br/>
                                    ğŸ“± å®Œç¾éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´æ‰‹æ©Ÿå’Œé›»è…¦<br/>
                                    ğŸ’¾ åœ–ç‰‡æ°¸ä¹…ä¿å­˜ï¼Œå¯éš¨æ™‚ç®¡ç†å’Œæ›´æ›
                                </div>
                            </div>
                            
                            <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                ğŸ“± æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ | ğŸ¨ æ°¸ä¹…åœ–ç‰‡åŠŸèƒ½ | â±ï¸ 30åˆ†é˜å®Œæ•´é«”é©—<br/>
                                ğŸ’¾ åœ–ç‰‡æ°¸ä¹…ä¿å­˜ | ğŸŒ æ”¯æ´GitHubåˆ†äº« | ğŸ”— å¯ç”¨ç·šä¸ŠURL
                            </div>
                        </div>
                    </div>
                );
            }

            // è§’è‰²å‰µå»ºç•Œé¢
            if (gameState === 'character_creation') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '600px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ 
                                fontSize: '2rem', 
                                fontWeight: 'bold', 
                                marginBottom: '1rem', 
                                color: '#fbbf24'
                            }}>
                                ğŸ‘¤ å‰µå»ºä½ çš„è‹±é›„
                            </h1>
                            
                            <ImageDisplay />
                            
                            <div className="game-card" style={{ padding: '1.5rem', marginBottom: '2rem' }}>
                                <h3 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: '#fbbf24' }}>é¸æ“‡è·æ¥­</h3>
                                
                                <div className="class-selection" style={{ marginBottom: '1.5rem' }}>
                                    {Object.entries(classes).map(([key, cls]) => (
                                        <div
                                            key={key}
                                            onClick={() => setSelectedClass(key)}
                                            className={`class-card ${selectedClass === key ? 'selected' : ''}`}
                                        >
                                            <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>{cls.emoji}</div>
                                            <h4 style={{ fontSize: '1rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>{cls.name}</h4>
                                            <p style={{ fontSize: '0.8rem', color: '#d1d5db', marginBottom: '0.75rem' }}>
                                                {cls.description}
                                            </p>
                                            <div style={{ fontSize: '0.7rem', textAlign: 'left' }}>
                                                <div>æ”»æ“Š: +{cls.bonuses.attack}</div>
                                                <div>é˜²ç¦¦: +{cls.bonuses.defense}</div>
                                                {cls.bonuses.hp && <div>è¡€é‡: +{cls.bonuses.hp}</div>}
                                                {cls.bonuses.mp && <div>é­”åŠ›: +{cls.bonuses.mp}</div>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <input
                                    type="text"
                                    placeholder="è¼¸å…¥ä½ çš„è‹±é›„åå­—"
                                    value={player.name}
                                    onChange={(e) => setPlayer(prev => ({ ...prev, name: e.target.value }))}
                                    className="input-field"
                                    style={{ marginBottom: '1.5rem', maxWidth: '250px' }}
                                />
                                
                                <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', flexWrap: 'wrap' }}>
                                    <button
                                        onClick={() => {
                                            if (player.name.trim() && selectedClass) {
                                                const classData = classes[selectedClass];
                                                setPlayer(prev => ({
                                                    ...prev,
                                                    class: selectedClass,
                                                    maxHp: prev.maxHp + (classData.bonuses.hp || 0),
                                                    hp: prev.hp + (classData.bonuses.hp || 0),
                                                    maxMp: prev.maxMp + (classData.bonuses.mp || 0),
                                                    mp: prev.mp + (classData.bonuses.mp || 0),
                                                    attack: prev.attack + classData.bonuses.attack,
                                                    defense: prev.defense + classData.bonuses.defense,
                                                    speed: prev.speed + (classData.bonuses.speed || 0),
                                                    luck: prev.luck + (classData.bonuses.luck || 0),
                                                    skills: Object.fromEntries(classData.skills.slice(0, 2).map(skill => [skill, 1]))
                                                }));
                                                setGameState('playing');
                                                setImage('forest');
                                                addLog(`${classData.emoji} ${player.name} é¸æ“‡äº†${classData.name}è·æ¥­ï¼Œé–‹å§‹å†’éšªï¼`, "important");
                                            }
                                        }}
                                        disabled={!player.name.trim() || !selectedClass}
                                        className="btn btn-primary"
                                        style={{ 
                                            fontSize: '1rem',
                                            padding: '1rem 2rem',
                                            opacity: (!player.name.trim() || !selectedClass) ? 0.5 : 1
                                        }}
                                    >
                                        ğŸš€ é–‹å§‹å†’éšª
                                    </button>
                                    
                                    <button
                                        onClick={() => setGameState('gallery')}
                                        className="btn btn-secondary"
                                        style={{ 
                                            fontSize: '1rem',
                                            padding: '1rem 2rem'
                                        }}
                                    >
                                        ğŸ–¼ï¸ ç®¡ç†åœ–ç‰‡
                                    </button>
                                    
                                    <button
                                        onClick={() => setGameState('menu')}
                                        className="btn btn-warning"
                                        style={{ 
                                            fontSize: '1rem',
                                            padding: '1rem 2rem'
                                        }}
                                    >
                                        â¬…ï¸ è¿”å›ä¸»é¸å–®
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // å‹åˆ©ç•Œé¢
            if (gameState === 'victory') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        background: 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%)',
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '600px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ fontSize: '2.5rem', fontWeight: 'bold', marginBottom: '1rem', color: 'white' }}>
                                ğŸ† å‚³èªªèª•ç”Ÿï¼ ğŸ†
                            </h1>
                            
                            <ImageDisplay />
                            
                            <div className="game-card" style={{ padding: '1.5rem', background: 'rgba(0,0,0,0.7)' }}>
                                <p style={{ fontSize: '1.1rem', marginBottom: '1rem' }}>
                                    ğŸ‰ æ­å–œ {classes[player.class]?.emoji} {player.name}ï¼
                                </p>
                                <p style={{ fontSize: '0.9rem', marginBottom: '1.5rem' }}>
                                    ä½ æˆåŠŸæ“Šæ•—äº†æ¯€æ»…é­”ç‹ï¼Œæ‹¯æ•‘äº†ä¸–ç•Œï¼
                                </p>
                                
                                <div style={{ marginBottom: '1.5rem', fontSize: '0.8rem' }}>
                                    <div>ç­‰ç´šï¼š{player.level} | æ™‚é–“ï¼š{formatTime(gameTime)}</div>
                                    <div>æ“Šæ•—æ•µäººï¼š{player.stats.enemiesDefeated}</div>
                                    <div>æ”¶é›†å¯¶è—ï¼š{player.stats.treasuresFound}</div>
                                </div>
                                
                                <button
                                    onClick={() => {
                                        setGameState('menu');
                                        setSelectedClass(null);
                                        setPlayer({
                                            name: '',
                                            class: null,
                                            level: 1,
                                            hp: 100,
                                            maxHp: 100,
                                            mp: 50,
                                            maxMp: 50,
                                            attack: 20,
                                            defense: 10,
                                            speed: 15,
                                            luck: 10,
                                            exp: 0,
                                            gold: 100,
                                            skillPoints: 0,
                                            inventory: [],
                                            equipment: { weapon: null, armor: null, accessory: null },
                                            skills: {},
                                            statusEffects: [],
                                            stats: { enemiesDefeated: 0, areasCleared: 0, treasuresFound: 0, goldEarned: 0 }
                                        });
                                        setCurrentArea(0);
                                        setBattleState(null);
                                        setGameLog([]);
                                        setGameTime(0);
                                        setCombatAnimations([]);
                                        setActiveTab('inventory');
                                        setImage('menu');
                                    }}
                                    className="btn btn-purple"
                                    style={{ fontSize: '1rem', padding: '1rem 2rem' }}
                                >
                                    âœ¨ é–‹å§‹æ–°å‚³èªª
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // éŠæˆ²çµæŸç•Œé¢
            if (gameState === 'gameOver') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        background: 'linear-gradient(135deg, #7f1d1d 0%, #450a0a 50%, #000000 100%)',
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '500px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ fontSize: '2rem', fontWeight: 'bold', marginBottom: '1rem', color: '#f87171' }}>
                                ğŸ’€ è‹±é›„éš•è½ ğŸ’€
                            </h1>
                            
                            <ImageDisplay />
                            
                            <div className="game-card" style={{ padding: '1.5rem' }}>
                                <p style={{ fontSize: '1rem', marginBottom: '1.5rem' }}>ä½ çš„å†’éšªå°±æ­¤çµæŸ...</p>
                                <div style={{ marginBottom: '1.5rem', fontSize: '0.9rem' }}>
                                    <div>ç­‰ç´šï¼š{player.level} | æ™‚é–“ï¼š{formatTime(gameTime)}</div>
                                    <div>å€åŸŸï¼š{areas[currentArea]?.name || "é­”ç‹åŸ"}</div>
                                    <div>æ“Šæ•—æ•µäººï¼š{player.stats.enemiesDefeated}</div>
                                </div>
                                <button
                                    onClick={() => {
                                        setGameState('menu');
                                        setSelectedClass(null);
                                        setPlayer({
                                            name: '',
                                            class: null,
                                            level: 1,
                                            hp: 100,
                                            maxHp: 100,
                                            mp: 50,
                                            maxMp: 50,
                                            attack: 20,
                                            defense: 10,
                                            speed: 15,
                                            luck: 10,
                                            exp: 0,
                                            gold: 100,
                                            skillPoints: 0,
                                            inventory: [],
                                            equipment: { weapon: null, armor: null, accessory: null },
                                            skills: {},
                                            statusEffects: [],
                                            stats: { enemiesDefeated: 0, areasCleared: 0, treasuresFound: 0, goldEarned: 0 }
                                        });
                                        setCurrentArea(0);
                                        setBattleState(null);
                                        setGameLog([]);
                                        setGameTime(0);
                                        setCombatAnimations([]);
                                        setActiveTab('inventory');
                                        setImage('menu');
                                    }}
                                    className="btn btn-secondary"
                                    style={{ fontSize: '1rem', padding: '1rem 2rem' }}
                                >
                                    ğŸ”„ é‡æ–°é–‹å§‹
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // åœ–ç‰‡åº«ç•Œé¢
            if (gameState === 'gallery') {
                const getFilteredImages = () => {
                    const allImages = Object.keys(imagePrompts);
                    switch (galleryFilter) {
                        case 'uploaded':
                            return allImages.filter(key => uploadedImages[key] && uploadedImages[key] !== defaultImageUrls[key]);
                        case 'default':
                            return allImages.filter(key => uploadedImages[key] === defaultImageUrls[key]);
                        case 'missing':
                            return allImages.filter(key => !uploadedImages[key]);
                        default:
                            return allImages;
                    }
                };

                const getImageStats = () => {
                    const total = Object.keys(imagePrompts).length;
                    const uploaded = Object.keys(uploadedImages).filter(key => 
                        uploadedImages[key] && uploadedImages[key] !== defaultImageUrls[key]
                    ).length;
                    const defaults = Object.keys(uploadedImages).filter(key => 
                        uploadedImages[key] === defaultImageUrls[key]
                    ).length;
                    const missing = total - Object.keys(uploadedImages).length;
                    return { total, uploaded, defaults, missing };
                };

                const getImageCategory = (imageKey) => {
                    if (['warrior', 'mage', 'rogue'].includes(imageKey)) return 'è·æ¥­';
                    if (['forest', 'mountain', 'desert', 'icefield', 'volcano'].includes(imageKey)) return 'å ´æ™¯';
                    if (['forestWolf', 'corruptedTreespirit', 'poisonSpider', 'forestGuardian', 
                         'snowLeopard', 'stoneGiant', 'stormEagle', 'mountainKing',
                         'sandScorpion', 'dustDemon', 'sunLizard', 'desertOverlord',
                         'frostWolf', 'iceElemental', 'yeti', 'frostQueen',
                         'lavaBeast', 'flameDemon', 'hellKnight', 'fireLord',
                         'demonKing'].includes(imageKey)) return 'æ•µäºº';
                    if (['goldCoins', 'forestSword', 'healthPotion', 'iceSword', 'holyBlade'].includes(imageKey)) return 'ç‰©å“';
                    if (['combat', 'levelUp', 'skillLearned', 'treasureFound', 'exploration', 'rest'].includes(imageKey)) return 'æ•ˆæœ';
                    if (['menu', 'victory', 'gameOver'].includes(imageKey)) return 'éŠæˆ²';
                    return 'å…¶ä»–';
                };

                const filteredImages = getFilteredImages();
                const stats = getImageStats();

                return (
                    <div className="gallery-container">
                        <div className="gallery-header">
                            <h1 style={{ 
                                fontSize: '2rem', 
                                fontWeight: 'bold', 
                                marginBottom: '0.5rem', 
                                color: '#fbbf24' 
                            }}>
                                ğŸ–¼ï¸ åœ–ç‰‡ç®¡ç†ä¸­å¿ƒ
                            </h1>
                            <p style={{ 
                                fontSize: '1rem', 
                                color: '#9ca3af',
                                marginBottom: '1rem'
                            }}>
                                ç®¡ç†AIç”Ÿæˆçš„éŠæˆ²åœ–ç‰‡è³‡æºåº« - å®Œæ•´ç‰ˆ
                            </p>
                        </div>

                        <div className="gallery-stats">
                            <div className="stat-card">
                                <h3 style={{ fontSize: '1.5rem', color: '#22c55e', marginBottom: '0.5rem' }}>
                                    {stats.defaults}
                                </h3>
                                <p style={{ fontSize: '0.8rem', color: '#9ca3af' }}>é è¨­åœ–ç‰‡</p>
                            </div>
                            <div className="stat-card">
                                <h3 style={{ fontSize: '1.5rem', color: '#3b82f6', marginBottom: '0.5rem' }}>
                                    {stats.uploaded}
                                </h3>
                                <p style={{ fontSize: '0.8rem', color: '#9ca3af' }}>è‡ªè¨‚åœ–ç‰‡</p>
                            </div>
                            <div className="stat-card">
                                <h3 style={{ fontSize: '1.5rem', color: '#ef4444', marginBottom: '0.5rem' }}>
                                    {stats.missing}
                                </h3>
                                <p style={{ fontSize: '0.8rem', color: '#9ca3af' }}>ç©ºç¼ºåœ–ç‰‡</p>
                            </div>
                            <div className="stat-card">
                                <h3 style={{ fontSize: '1.5rem', color: '#a855f7', marginBottom: '0.5rem' }}>
                                    {Math.round((stats.defaults + stats.uploaded) / stats.total * 100)}%
                                </h3>
                                <p style={{ fontSize: '0.8rem', color: '#9ca3af' }}>å®Œæˆåº¦</p>
                            </div>
                        </div>

                        <div className="gallery-filters">
                            <button
                                onClick={() => setGalleryFilter('all')}
                                className={`filter-btn ${galleryFilter === 'all' ? 'active' : ''}`}
                            >
                                ğŸ“‚ å…¨éƒ¨ ({Object.keys(imagePrompts).length})
                            </button>
                            <button
                                onClick={() => setGalleryFilter('default')}
                                className={`filter-btn ${galleryFilter === 'default' ? 'active' : ''}`}
                            >
                                ğŸ¨ é è¨­åœ–ç‰‡ ({stats.defaults})
                            </button>
                            <button
                                onClick={() => setGalleryFilter('uploaded')}
                                className={`filter-btn ${galleryFilter === 'uploaded' ? 'active' : ''}`}
                            >
                                ğŸ“¤ è‡ªè¨‚åœ–ç‰‡ ({stats.uploaded})
                            </button>
                            <button
                                onClick={() => setGalleryFilter('missing')}
                                className={`filter-btn ${galleryFilter === 'missing' ? 'active' : ''}`}
                            >
                                âŒ ç©ºç¼ºåœ–ç‰‡ ({stats.missing})
                            </button>
                        </div>

                        <div style={{ 
                            display: 'flex', 
                            gap: '1rem', 
                            marginBottom: '2rem', 
                            justifyContent: 'center',
                            flexWrap: 'wrap'
                        }}>
                            <button
                                onClick={() => setGameState('character_creation')}
                                className="btn btn-secondary"
                                style={{ padding: '0.75rem 1.5rem' }}
                            >
                                ğŸ‘¤ å‰µå»ºè§’è‰²
                            </button>
                            <button
                                onClick={() => setGameState('menu')}
                                className="btn btn-warning"
                                style={{ padding: '0.75rem 1.5rem' }}
                            >
                                â¬…ï¸ è¿”å›ä¸»é¸å–®
                            </button>
                        </div>

                        <div className="gallery-grid">
                            {filteredImages.map(imageKey => {
                                const imageData = imagePrompts[imageKey];
                                const hasImage = uploadedImages[imageKey];
                                const isDefault = hasImage === defaultImageUrls[imageKey];
                                const category = getImageCategory(imageKey);

                                return (
                                    <div key={imageKey} className="gallery-item">
                                        <div className="gallery-item-header">
                                            <h3 className="gallery-item-title">
                                                {imageData.title}
                                            </h3>
                                            <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                <span className="gallery-item-category">
                                                    {category}
                                                </span>
                                                {isDefault && (
                                                    <span style={{
                                                        fontSize: '0.7rem',
                                                        background: 'rgba(34, 197, 94, 0.2)',
                                                        color: '#22c55e',
                                                        padding: '0.25rem 0.5rem',
                                                        borderRadius: '4px'
                                                    }}>
                                                        é è¨­
                                                    </span>
                                                )}
                                            </div>
                                        </div>

                                        <div className="gallery-item-image">
                                            {hasImage ? (
                                                <img 
                                                    src={uploadedImages[imageKey]} 
                                                    alt={imageData.title}
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'flex';
                                                    }}
                                                />
                                            ) : null}
                                            <div 
                                                className="gallery-item-placeholder"
                                                style={{ 
                                                    display: hasImage ? 'none' : 'flex',
                                                    flexDirection: 'column',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    height: '100%'
                                                }}
                                            >
                                                <div style={{ fontSize: '3rem', marginBottom: '0.5rem' }}>
                                                    {hasImage ? 'ğŸ–¼ï¸' : 'ğŸ“·'}
                                                </div>
                                                <div style={{ fontSize: '0.9rem' }}>
                                                    {hasImage ? 'åœ–ç‰‡è¼‰å…¥å¤±æ•—' : 'ç­‰å¾…ä¸Šå‚³'}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="gallery-item-footer">
                                            <div className="gallery-item-prompt">
                                                <strong>AIæç¤ºè©ï¼š</strong>
                                                {imageData.prompt}
                                            </div>

                                            <div className="gallery-item-actions">
                                                <button
                                                    onClick={async () => {
                                                        try {
                                                            await navigator.clipboard.writeText(imageData.prompt);
                                                            alert('âœ… AIåœ–ç‰‡æç¤ºè©å·²è¤‡è£½ï¼');
                                                        } catch (err) {
                                                            const textArea = document.createElement('textarea');
                                                            textArea.value = imageData.prompt;
                                                            document.body.appendChild(textArea);
                                                            textArea.select();
                                                            document.execCommand('copy');
                                                            document.body.removeChild(textArea);
                                                            alert('âœ… AIåœ–ç‰‡æç¤ºè©å·²è¤‡è£½ï¼');
                                                        }
                                                    }}
                                                    className="gallery-action-btn"
                                                    style={{ 
                                                        background: 'linear-gradient(45deg, #3b82f6, #1d4ed8)',
                                                        color: 'white'
                                                    }}
                                                >
                                                    ğŸ“‹ è¤‡è£½æç¤ºè©
                                                </button>
                                                
                                                <button
                                                    onClick={() => setShowImageUpload(imageKey)}
                                                    className="gallery-action-btn"
                                                    style={{ 
                                                        background: hasImage ? 
                                                            'linear-gradient(45deg, #f59e0b, #d97706)' : 
                                                            'linear-gradient(45deg, #22c55e, #16a34a)',
                                                        color: 'white'
                                                    }}
                                                >
                                                    {hasImage ? 'ğŸ”„ æ›´æ›åœ–ç‰‡' : 'ğŸ“¤ ä¸Šå‚³åœ–ç‰‡'}
                                                </button>

                                                {hasImage && !isDefault && (
                                                    <button
                                                        onClick={() => {
                                                            if (window.confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${imageData.title}ã€çš„è‡ªè¨‚åœ–ç‰‡å—ï¼Ÿå°‡æ¢å¾©ç‚ºé è¨­åœ–ç‰‡ã€‚`)) {
                                                                const newImages = { ...uploadedImages };
                                                                if (defaultImageUrls[imageKey]) {
                                                                    newImages[imageKey] = defaultImageUrls[imageKey];
                                                                } else {
                                                                    delete newImages[imageKey];
                                                                }
                                                                setUploadedImages(newImages);
                                                                saveImagesToStorage(newImages);
                                                                if (currentImage.title === imageData.title) {
                                                                    setCurrentImage(prev => ({
                                                                        ...prev,
                                                                        imageUrl: defaultImageUrls[imageKey] || ''
                                                                    }));
                                                                }
                                                                alert('ğŸ”„ å·²æ¢å¾©ç‚ºé è¨­åœ–ç‰‡');
                                                            }
                                                        }}
                                                        className="gallery-action-btn"
                                                        style={{ 
                                                            background: 'linear-gradient(45deg, #ef4444, #dc2626)',
                                                            color: 'white'
                                                        }}
                                                    >
                                                        ğŸ”„ æ¢å¾©é è¨­
                                                    </button>
                                                )}

                                                <button
                                                    onClick={() => {
                                                        setImage(imageKey);
                                                        setGameState('menu');
                                                    }}
                                                    className="gallery-action-btn"
                                                    style={{ 
                                                        background: 'linear-gradient(45deg, #8b5cf6, #7c3aed)',
                                                        color: 'white'
                                                    }}
                                                >
                                                    ğŸ‘ï¸ é è¦½
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {filteredImages.length === 0 && (
                            <div style={{ 
                                textAlign: 'center', 
                                padding: '3rem 1rem',
                                color: '#9ca3af'
                            }}>
                                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>ğŸ“­</div>
                                <h3 style={{ fontSize: '1.2rem', marginBottom: '0.5rem' }}>æ²’æœ‰æ‰¾åˆ°åœ–ç‰‡</h3>
                                <p>å˜—è©¦åˆ‡æ›ä¸åŒçš„éæ¿¾æ¢ä»¶</p>
                            </div>
                        )}

                        <div style={{ 
                            marginTop: '3rem',
                            padding: '1.5rem',
                            background: 'rgba(0, 0, 0, 0.3)',
                            borderRadius: '12px',
                            textAlign: 'center',
                            fontSize: '0.9rem',
                            lineHeight: '1.6',
                            color: '#d1d5db'
                        }}>
                            <h4 style={{ color: '#fbbf24', marginBottom: '1rem', fontSize: '1.2rem' }}>
                                ğŸ¬ å®Œæ•´åœ–ç‰‡ç‰ˆèªªæ˜
                            </h4>
                            
                            <div style={{ 
                                display: 'grid', 
                                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', 
                                gap: '1.5rem',
                                textAlign: 'left',
                                marginBottom: '1.5rem'
                            }}>
                                <div style={{
                                    background: 'rgba(34, 197, 94, 0.1)',
                                    padding: '1rem',
                                    borderRadius: '8px',
                                    border: '1px solid rgba(34, 197, 94, 0.3)'
                                }}>
                                    <strong>ğŸ¨ é è¨­åœ–ç‰‡</strong><br/>
                                    å…§å»º43å¼µé«˜å“è³ªAIç”Ÿæˆåœ–ç‰‡ï¼Œä¾†è‡ªGitHubï¼ŒåŒ…å«æ‰€æœ‰éŠæˆ²å ´æ™¯
                                </div>
                                <div style={{
                                    background: 'rgba(59, 130, 246, 0.1)',
                                    padding: '1rem',
                                    borderRadius: '8px',
                                    border: '1px solid rgba(59, 130, 246, 0.3)'
                                }}>
                                    <strong>ğŸ“¤ è‡ªè¨‚ä¸Šå‚³</strong><br/>
                                    å¯ä»¥ä¸Šå‚³è‡ªå·±çš„åœ–ç‰‡æˆ–ä½¿ç”¨ç·šä¸ŠURLæ›¿æ›ä»»ä½•é è¨­åœ–ç‰‡
                                </div>
                                <div style={{
                                    background: 'rgba(168, 85, 247, 0.1)',
                                    padding: '1rem',
                                    borderRadius: '8px',
                                    border: '1px solid rgba(168, 85, 247, 0.3)'
                                }}>
                                    <strong>ğŸ¬ é›»å½±ç´šæ§‹åœ–</strong><br/>
                                    æ‰€æœ‰AIæç¤ºè©å„ªåŒ–ç‚º16:9æ©«å‘æ§‹åœ–ï¼Œé©é…éŠæˆ²é¡¯ç¤ºæ¡†
                                </div>
                                <div style={{
                                    background: 'rgba(245, 158, 11, 0.1)',
                                    padding: '1rem',
                                    borderRadius: '8px',
                                    border: '1px solid rgba(245, 158, 11, 0.3)'
                                }}>
                                    <strong>ğŸ’¾ æ°¸ä¹…ä¿å­˜</strong><br/>
                                    è‡ªè¨‚åœ–ç‰‡æ°¸ä¹…ä¿å­˜åœ¨ç€è¦½å™¨ï¼Œä¸æœƒéºå¤±
                                </div>
                            </div>
                            
                            <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                ğŸ¤– <strong>æ¨è–¦AIå·¥å…·</strong>ï¼šDALL-E 3ã€Midjourney v6ã€Stable Diffusion XL<br/>
                                ğŸ¨ <strong>å®Œæ•´é«”é©—</strong>ï¼šé è¨­åœ–ç‰‡ + è‡ªè¨‚åœ–ç‰‡ + å®Œç¾æˆ°é¬¥ç•Œé¢
                            </div>
                        </div>
                    </div>
                );
            }

            // åœ–ç‰‡ä¸Šå‚³æ¨¡æ…‹æ¡†çµ„ä»¶
            const ImageUploadModal = () => {
                const [imageUrl, setImageUrl] = useState('');
                const [uploadMethod, setUploadMethod] = useState('file');
                
                if (!showImageUpload) return null;

                const imageData = imagePrompts[showImageUpload];
                
                return (
                    <div style={{
                        position: 'fixed',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        background: 'rgba(0, 0, 0, 0.8)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        zIndex: 2000,
                        padding: '1rem'
                    }}>
                        <div className="game-card" style={{ 
                            padding: '2rem', 
                            maxWidth: '500px', 
                            width: '100%',
                            position: 'relative',
                            maxHeight: '90vh',
                            overflowY: 'auto'
                        }}>
                            <button
                                onClick={() => setShowImageUpload(false)}
                                style={{
                                    position: 'absolute',
                                    top: '1rem',
                                    right: '1rem',
                                    background: 'rgba(239, 68, 68, 0.8)',
                                    border: 'none',
                                    color: 'white',
                                    width: '2rem',
                                    height: '2rem',
                                    borderRadius: '50%',
                                    cursor: 'pointer',
                                    fontSize: '1rem'
                                }}
                            >
                                Ã—
                            </button>
                            
                            <h3 style={{ 
                                fontSize: '1.2rem', 
                                marginBottom: '1rem', 
                                color: '#fbbf24',
                                textAlign: 'center'
                            }}>
                                ğŸ¬ ä¸Šå‚³åœ–ç‰‡ï¼š{imageData?.title}
                            </h3>
                            
                            <div style={{ 
                                background: 'rgba(0, 0, 0, 0.3)', 
                                padding: '1rem', 
                                borderRadius: '8px',
                                marginBottom: '1.5rem',
                                fontSize: '0.8rem',
                                lineHeight: '1.4'
                            }}>
                                <div style={{ fontWeight: 'bold', marginBottom: '0.5rem', color: '#10b981' }}>
                                    ğŸ¬ é›»å½±ç´šæ©«å‘æ§‹åœ–æç¤ºè©ï¼š
                                </div>
                                <div style={{ 
                                    fontStyle: 'italic', 
                                    color: '#d1d5db', 
                                    marginBottom: '0.75rem',
                                    maxHeight: '100px',
                                    overflowY: 'auto',
                                    padding: '0.5rem',
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    borderRadius: '4px'
                                }}>
                                    {imageData?.prompt}
                                </div>
                                
                                <div style={{ 
                                    background: 'rgba(59, 130, 246, 0.1)', 
                                    padding: '0.5rem', 
                                    borderRadius: '4px',
                                    border: '1px solid rgba(59, 130, 246, 0.3)'
                                }}>
                                    <div style={{ fontWeight: 'bold', color: '#60a5fa', marginBottom: '0.25rem' }}>
                                        ğŸ¯ æœ€ä½³å°ºå¯¸å»ºè­°ï¼š
                                    </div>
                                    <div style={{ fontSize: '0.7rem', color: '#bfdbfe' }}>
                                        ğŸ“½ï¸ é›»å½±ç´šæ©«å‘ï¼š1024Ã—576 (16:9) æˆ– 1152Ã—648<br/>
                                        ğŸ–¥ï¸ å¯¬è¢å¹•ç‰ˆï¼š1280Ã—720 æˆ– 1440Ã—810<br/>
                                        ğŸ’¡ æç¤ºè©å·²é‡å°æ©«å‘5:2é¡¯ç¤ºæ¡†å„ªåŒ–
                                    </div>
                                </div>
                            </div>

                            <div style={{ marginBottom: '1.5rem' }}>
                                <div style={{ display: 'flex', gap: '1rem', marginBottom: '1rem' }}>
                                    <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
                                        <input
                                            type="radio"
                                            value="file"
                                            checked={uploadMethod === 'file'}
                                            onChange={(e) => setUploadMethod(e.target.value)}
                                            style={{ marginRight: '0.5rem' }}
                                        />
                                        ğŸ“ ä¸Šå‚³æª”æ¡ˆ
                                    </label>
                                    <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
                                        <input
                                            type="radio"
                                            value="url"
                                            checked={uploadMethod === 'url'}
                                            onChange={(e) => setUploadMethod(e.target.value)}
                                            style={{ marginRight: '0.5rem' }}
                                        />
                                        ğŸ”— ç·šä¸ŠURL
                                    </label>
                                </div>

                                {uploadMethod === 'file' ? (
                                    <div>
                                        <p style={{ marginBottom: '1rem', fontSize: '0.9rem', color: '#d1d5db' }}>
                                            é¸æ“‡AIç”Ÿæˆçš„åœ–ç‰‡æª”æ¡ˆï¼ˆæ”¯æ´ JPG, PNG, GIF, WebPï¼‰
                                        </p>
                                        
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={(e) => {
                                                const file = e.target.files[0];
                                                if (file) {
                                                    handleImageUpload(showImageUpload, file);
                                                }
                                            }}
                                            style={{
                                                marginBottom: '1rem',
                                                padding: '0.5rem',
                                                background: 'rgba(255, 255, 255, 0.1)',
                                                border: '1px solid rgba(255, 255, 255, 0.2)',
                                                borderRadius: '4px',
                                                color: 'white',
                                                width: '100%'
                                            }}
                                        />
                                        
                                        <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                            ğŸ’¡ åœ–ç‰‡æœƒæ°¸ä¹…ä¿å­˜åœ¨ç€è¦½å™¨ä¸­<br/>
                                            ğŸ“ å»ºè­°ä½¿ç”¨æ©«å‘æ§‹åœ–çš„AIç”Ÿæˆåœ–ç‰‡<br/>
                                            ğŸ¨ æ”¯æ´4ç¨®é¡¯ç¤ºæ¨¡å¼èª¿æ•´
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <p style={{ marginBottom: '1rem', fontSize: '0.9rem', color: '#d1d5db' }}>
                                            è¼¸å…¥ç·šä¸Šåœ–ç‰‡URLï¼ˆé©åˆGitHubåˆ†äº«ï¼‰
                                        </p>
                                        
                                        <input
                                            type="url"
                                            placeholder="https://example.com/image.jpg"
                                            value={imageUrl}
                                            onChange={(e) => setImageUrl(e.target.value)}
                                            style={{
                                                marginBottom: '1rem',
                                                padding: '0.5rem',
                                                background: 'rgba(255, 255, 255, 0.1)',
                                                border: '1px solid rgba(255, 255, 255, 0.2)',
                                                borderRadius: '4px',
                                                color: 'white',
                                                width: '100%'
                                            }}
                                        />
                                        
                                        <button
                                            onClick={() => handleImageUrl(showImageUpload, imageUrl)}
                                            className="btn btn-success"
                                            style={{ width: '100%', marginBottom: '1rem' }}
                                        >
                                            ğŸ”— ä½¿ç”¨æ­¤URL
                                        </button>
                                        
                                        <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                            ğŸ’¡ å»ºè­°ä½¿ç”¨ï¼šImgurã€GitHubã€Cloudinaryç­‰ç©©å®šåœ–åºŠ<br/>
                                            ğŸŒ URLå¿…é ˆç›´æ¥æŒ‡å‘åœ–ç‰‡æª”æ¡ˆ<br/>
                                            ğŸ“ æç¤ºè©å·²åŒ…å«æœ€ä½³é•·å¯¬æ¯”å»ºè­°
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            <div style={{ fontSize: '0.8rem', color: '#9ca3af', textAlign: 'center' }}>
                                ğŸ¤– æ¨è–¦AIå·¥å…·ï¼šDALL-Eã€Midjourneyã€Stable Diffusion<br/>
                                ğŸ“ æç¤ºè©å·²å„ªåŒ–é•·å¯¬æ¯”ï¼Œç›´æ¥ä½¿ç”¨å³å¯ç²å¾—æœ€ä½³æ•ˆæœ
                            </div>
                        </div>
                    </div>
                );
            };

            // æˆ°é¬¥å‹•ç•«çµ„ä»¶
            const CombatAnimations = () => (
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, pointerEvents: 'none', zIndex: 1000 }}>
                    {combatAnimations.map(anim => (
                        <div
                            key={anim.id}
                            className="combat-animation"
                            style={{
                                left: Math.random() * 60 + 20 + '%',
                                top: Math.random() * 40 + 30 + '%',
                                fontSize: anim.type === 'critical' || anim.type === 'level_up' ? '1.5rem' : '1.2rem',
                                color: 
                                    anim.type === 'critical' ? '#dc2626' :
                                    anim.type === 'damage' ? '#f97316' :
                                    anim.type === 'heal' ? '#22c55e' :
                                    anim.type === 'level_up' ? '#fbbf24' :
                                    '#9ca3af'
                            }}
                        >
                            {anim.text}
                        </div>
                    ))}
                </div>
            );

            // ä¸»éŠæˆ²ç•Œé¢
            if (gameState === 'playing') {
                const playerStats = {
                    attack: player.attack + (player.equipment.weapon?.attack || 0),
                    defense: player.defense + (player.equipment.armor?.defense || 0),
                    speed: player.speed,
                    luck: player.luck
                };

                return (
                    <div className="mobile-layout">
                        <CombatAnimations />
                        <ImageUploadModal />
                        
                        {/* é ‚éƒ¨ç‹€æ…‹æ¬„ */}
                        <div className="top-panel">
                            <div className="game-card sticky-header" style={{ padding: '1rem' }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.75rem' }}>
                                    <div style={{ fontSize: '1rem', fontWeight: 'bold', color: '#fbbf24' }}>
                                        {classes[player.class]?.emoji} {player.name}
                                    </div>
                                    <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                        Lv.{player.level} | â° {formatTime(gameTime)}
                                    </div>
                                </div>
                                
                                <ProgressBar 
                                    emoji="â¤ï¸" 
                                    current={player.hp} 
                                    max={player.maxHp} 
                                    color="linear-gradient(90deg, #dc2626, #ef4444)" 
                                />
                                <ProgressBar 
                                    emoji="âš¡" 
                                    current={player.mp} 
                                    max={player.maxMp} 
                                    color="linear-gradient(90deg, #2563eb, #3b82f6)" 
                                />
                                <ProgressBar 
                                    emoji="â­" 
                                    current={player.exp} 
                                    max={(player.level + 1) * 100} 
                                    color="linear-gradient(90deg, #fbbf24, #f59e0b)" 
                                />
                                
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '0.5rem', fontSize: '0.75rem', marginTop: '0.5rem' }}>
                                    <div>âš”ï¸ {playerStats.attack}</div>
                                    <div>ğŸ›¡ï¸ {playerStats.defense}</div>
                                    <div>ğŸ’° {player.gold}</div>
                                    <div>ğŸŒŸ {player.skillPoints}</div>
                                </div>
                            </div>
                        </div>

                        {/* ä¸»éŠæˆ²å€åŸŸ */}
                        <div className="main-game-area">
                            <div className="game-card" style={{ padding: '1rem', margin: '0.5rem 0', flex: 1 }}>
                                <ImageDisplay />
                                
                                {/* å€åŸŸæ¨™é¡Œ */}
                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1rem' }}>
                                    <span style={{ fontSize: '1.5rem' }}>
                                        {currentArea < areas.length ? areas[currentArea].emoji : "ğŸ°"}
                                    </span>
                                    <div>
                                        <h2 style={{ fontSize: '1.1rem', fontWeight: 'bold', color: '#10b981' }}>
                                            {currentArea < areas.length ? areas[currentArea].name : 'é­”ç‹åŸ'}
                                        </h2>
                                        <p style={{ fontSize: '0.8rem', color: '#d1d5db' }}>
                                            {currentArea < areas.length ? areas[currentArea].description : "æœ€çµ‚æ±ºæˆ°..."}
                                        </p>
                                    </div>
                                </div>

                                {/* æˆ°é¬¥æˆ–æ¢ç´¢ç•Œé¢ */}
                                {battleState ? (
                                    <div className="battle-container">
                                        <div className="battle-info">
                                            <div style={{ 
                                                background: 'rgba(127, 29, 29, 0.7)', 
                                                padding: '0.75rem',
                                                borderRadius: '0.75rem',
                                                marginBottom: '0.5rem'
                                            }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                                                    <span style={{ fontWeight: 'bold', fontSize: '1rem' }}>
                                                        {battleState.name} {battleState.name === "æ¯€æ»…é­”ç‹" && "ğŸ‘‘"}
                                                    </span>
                                                    <span style={{ fontSize: '0.9rem' }}>{battleState.hp}/{battleState.maxHp}</span>
                                                </div>
                                                <div style={{ width: '100%', background: '#374151', borderRadius: '4px', height: '8px' }}>
                                                    <div 
                                                        style={{ 
                                                            background: 'linear-gradient(90deg, #dc2626, #ef4444)', 
                                                            height: '100%', 
                                                            borderRadius: '4px',
                                                            width: `${(battleState.hp / battleState.maxHp) * 100}%`,
                                                            transition: 'width 0.5s ease'
                                                        }}
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        <div className="battle-log">
                                            <div className="compact-log">
                                                {gameLog.slice(-6).reverse().map((log, index) => (
                                                    <div key={`battle-${gameLog.length - index}`} className="log-entry" style={{
                                                        background: 
                                                            log.type === 'attack' ? 'rgba(239, 68, 68, 0.2)' :
                                                            log.type === 'heal' ? 'rgba(34, 197, 94, 0.2)' :
                                                            log.type === 'victory' ? 'rgba(34, 197, 94, 0.3)' :
                                                            log.type === 'enemy_attack' ? 'rgba(220, 38, 38, 0.2)' :
                                                            'rgba(107, 114, 128, 0.2)',
                                                        color: 
                                                            log.type === 'attack' ? '#fca5a5' :
                                                            log.type === 'heal' ? '#86efac' :
                                                            log.type === 'victory' ? '#86efac' :
                                                            log.type === 'enemy_attack' ? '#fca5a5' :
                                                            '#d1d5db'
                                                    }}>
                                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                            <span style={{ flex: 1 }}>{log.message}</span>
                                                            {index === 0 && <span style={{ 
                                                                fontSize: '0.6rem', 
                                                                color: '#10b981', 
                                                                fontWeight: 'bold',
                                                                marginLeft: '0.5rem'
                                                            }}>æœ€æ–°</span>}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="battle-actions">
                                            <div className="quick-actions">
                                                <button 
                                                    onClick={() => {
                                                        let damage = Math.floor(playerStats.attack * (0.8 + Math.random() * 0.4));
                                                        const critChance = 0.1 + playerStats.luck / 200;
                                                        const isCrit = Math.random() < critChance;
                                                        if (isCrit) {
                                                            damage *= 1.5;
                                                            addCombatAnimation("CRITICAL!", "critical");
                                                        }
                                                        const finalDamage = Math.max(1, damage - (battleState.defense || 0));
                                                        setBattleState(prev => ({ ...prev, hp: prev.hp - finalDamage }));
                                                        addLog(`æ”»æ“Šé€ æˆ ${finalDamage} å‚·å®³ï¼`, "attack");
                                                        addCombatAnimation(`-${finalDamage}`, isCrit ? "critical" : "damage");
                                                        setLastAction("attack");
                                                    }} 
                                                    className="btn btn-primary quick-action-btn"
                                                >
                                                    <span>âš”ï¸</span>
                                                    <span>æ”»æ“Š</span>
                                                </button>
                                                <button 
                                                    onClick={() => {
                                                        setPlayer(prev => ({
                                                            ...prev,
                                                            statusEffects: [...prev.statusEffects, { type: "defense_boost", value: 2, duration: 1 }]
                                                        }));
                                                        addLog("æ¡å–é˜²ç¦¦å§¿æ…‹ï¼", "defend");
                                                        setLastAction("defend");
                                                    }}
                                                    className="btn btn-secondary quick-action-btn"
                                                >
                                                    <span>ğŸ›¡ï¸</span>
                                                    <span>é˜²ç¦¦</span>
                                                </button>
                                                
                                                {Object.keys(player.skills).slice(0, 2).map(skillName => (
                                                    <button
                                                        key={skillName}
                                                        onClick={() => {
                                                            const skill = skillDatabase[skillName];
                                                            if (player.mp < skill.mp) {
                                                                addLog("MPä¸è¶³ï¼", "error");
                                                                return;
                                                            }
                                                            
                                                            setPlayer(prev => ({ ...prev, mp: prev.mp - skill.mp }));
                                                            
                                                            if (skill.damage) {
                                                                let damage = Math.floor(playerStats.attack * skill.damage);
                                                                const critChance = (skill.crit || 0) + playerStats.luck / 200;
                                                                const isCrit = Math.random() < critChance;
                                                                if (isCrit) {
                                                                    damage *= 1.8;
                                                                    addCombatAnimation("CRITICAL!", "critical");
                                                                }
                                                                const finalDamage = Math.max(1, damage - (battleState.defense || 0));
                                                                setBattleState(prev => ({ ...prev, hp: prev.hp - finalDamage }));
                                                                addLog(`${skillName} é€ æˆ ${finalDamage} å‚·å®³ï¼`, "attack");
                                                                addCombatAnimation(`-${finalDamage}`, isCrit ? "critical" : "damage");
                                                            } else if (skill.heal) {
                                                                const healAmount = Math.floor(player.maxHp * skill.heal);
                                                                setPlayer(prev => ({ ...prev, hp: Math.min(prev.maxHp, prev.hp + healAmount) }));
                                                                addLog(`${skillName} æ¢å¾© ${healAmount} HPï¼`, "heal");
                                                                addCombatAnimation(`+${healAmount}`, "heal");
                                                            }
                                                            setLastAction("skill");
                                                        }}
                                                        disabled={player.mp < skillDatabase[skillName].mp}
                                                        className="btn btn-purple quick-action-btn"
                                                        style={{ 
                                                            opacity: player.mp < skillDatabase[skillName].mp ? 0.5 : 1
                                                        }}
                                                    >
                                                        <span>âœ¨</span>
                                                        <span>{skillName}</span>
                                                    </button>
                                                ))}
                                                
                                                {battleState.name !== "æ¯€æ»…é­”ç‹" && (
                                                    <button 
                                                        onClick={() => {
                                                            if (Math.random() < 0.7) {
                                                                setBattleState(null);
                                                                if (currentArea < areas.length) {
                                                                    setImage(areas[currentArea].imageKey);
                                                                }
                                                                addLog("æˆåŠŸé€ƒè„«äº†ï¼", "flee");
                                                            } else {
                                                                addLog("é€ƒè„«å¤±æ•—ï¼", "error");
                                                                setLastAction("flee_failed");
                                                            }
                                                        }}
                                                        className="btn btn-warning quick-action-btn"
                                                    >
                                                        <span>ğŸ’¨</span>
                                                        <span>é€ƒè·‘</span>
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <div className="quick-actions">
                                            <button 
                                                onClick={() => {
                                                    const area = areas[currentArea];
                                                    const eventRoll = Math.random();
                                                    
                                                    if (eventRoll < 0.5) {
                                                        const enemy = area.enemies[Math.floor(Math.random() * area.enemies.length)];
                                                        setBattleState({ ...enemy, maxHp: enemy.hp, statusEffects: [] });
                                                        if (enemy.imageKey) {
                                                            setImage(enemy.imageKey);
                                                        } else {
                                                            setImage('combat');
                                                        }
                                                        addLog(`é­é‡ ${enemy.name}ï¼`, "encounter");
                                                    } else if (eventRoll < 0.7) {
                                                        const treasure = area.treasures[Math.floor(Math.random() * area.treasures.length)];
                                                        setPlayer(prev => ({
                                                            ...prev,
                                                            inventory: [...prev.inventory, treasure],
                                                            stats: { ...prev.stats, treasuresFound: prev.stats.treasuresFound + 1 }
                                                        }));
                                                        if (treasure.imageKey) {
                                                            setImage(treasure.imageKey);
                                                        } else {
                                                            setImage('treasureFound');
                                                        }
                                                        addLog(`ç™¼ç¾ ${treasure.name}ï¼`, "treasure");
                                                    } else {
                                                        const goldFound = Math.floor(Math.random() * 50) + 20;
                                                        setPlayer(prev => ({
                                                            ...prev,
                                                            gold: prev.gold + goldFound,
                                                            stats: { ...prev.stats, goldEarned: prev.stats.goldEarned + goldFound }
                                                        }));
                                                        setImage('goldCoins');
                                                        addLog(`ç™¼ç¾ ${goldFound} é‡‘å¹£ï¼`, "gold");
                                                    }
                                                }}
                                                className="btn btn-success quick-action-btn"
                                            >
                                                <span>ğŸ”</span>
                                                <span>æ¢ç´¢</span>
                                            </button>
                                            
                                            {currentArea < areas.length && (
                                                <>
                                                    <button 
                                                        onClick={() => {
                                                            const area = areas[currentArea];
                                                            setBattleState({ ...area.boss, maxHp: area.boss.hp, statusEffects: [] });
                                                            if (area.boss.imageKey) {
                                                                setImage(area.boss.imageKey);
                                                            } else {
                                                                setImage('combat');
                                                            }
                                                            addLog(`ğŸ’€ ${area.boss.name} ç¾èº«ï¼`, "boss");
                                                        }}
                                                        className="btn btn-primary quick-action-btn"
                                                    >
                                                        <span>ğŸ’€</span>
                                                        <span>BOSS</span>
                                                    </button>
                                                    <button 
                                                        onClick={() => {
                                                            if (currentArea < areas.length - 1) {
                                                                setCurrentArea(prev => prev + 1);
                                                                setPlayer(prev => ({
                                                                    ...prev,
                                                                    stats: { ...prev.stats, areasCleared: prev.stats.areasCleared + 1 }
                                                                }));
                                                                const nextAreaData = areas[currentArea + 1];
                                                                setImage(nextAreaData.imageKey);
                                                                addLog(`é€²å…¥ ${nextAreaData.name}ï¼`, "area_change");
                                                            } else {
                                                                setBattleState({ ...demonKing, statusEffects: [] });
                                                                setImage('demonKing');
                                                                addLog("ğŸ”¥ æœ€çµ‚æ±ºæˆ°ï¼æ¯€æ»…é­”ç‹ç¾èº«ï¼", "boss");
                                                            }
                                                        }}
                                                        className="btn btn-secondary quick-action-btn"
                                                    >
                                                        <span>â¡ï¸</span>
                                                        <span>ä¸‹ä¸€å€</span>
                                                    </button>
                                                </>
                                            )}
                                        </div>

                                        <div style={{ marginTop: '1rem' }}>
                                            <h4 style={{ fontSize: '0.9rem', marginBottom: '0.5rem', color: '#06b6d4' }}>ğŸ“œ æœ€è¿‘å‹•æ…‹</h4>
                                            <div className="compact-log">
                                                {gameLog.slice(-5).reverse().map((log, index) => (
                                                    <div key={`explore-${gameLog.length - index}`} className="log-entry" style={{
                                                        background: 
                                                            log.type === 'treasure' ? 'rgba(245, 158, 11, 0.2)' :
                                                            log.type === 'gold' ? 'rgba(251, 191, 36, 0.2)' :
                                                            log.type === 'encounter' ? 'rgba(239, 68, 68, 0.2)' :
                                                            log.type === 'important' ? 'rgba(251, 191, 36, 0.2)' :
                                                            log.type === 'area_change' ? 'rgba(59, 130, 246, 0.2)' :
                                                            'rgba(107, 114, 128, 0.2)'
                                                    }}>
                                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                            <span style={{ flex: 1 }}>{log.message}</span>
                                                            {index === 0 && <span style={{ 
                                                                fontSize: '0.7rem', 
                                                                color: '#10b981', 
                                                                fontWeight: 'bold',
                                                                marginLeft: '0.5rem'
                                                            }}>æœ€æ–°</span>}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* åº•éƒ¨é¢æ¿ç°¡åŒ–ç‰ˆ */}
                        <div className="bottom-panel">
                            <div className="game-card" style={{ padding: '1rem', margin: '0.5rem 0' }}>
                                <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', flexWrap: 'wrap' }}>
                                    <button
                                        onClick={() => setGameState('gallery')}
                                        className="btn btn-secondary"
                                        style={{ fontSize: '0.8rem', padding: '0.5rem 1rem' }}
                                    >
                                        ğŸ–¼ï¸ åœ–ç‰‡ç®¡ç†
                                    </button>
                                    <button
                                        onClick={() => setGameState('menu')}
                                        className="btn btn-warning"
                                        style={{ fontSize: '0.8rem', padding: '0.5rem 1rem' }}
                                    >
                                        ğŸ  ä¸»é¸å–®
                                    </button>
                                </div>
                                
                                <div style={{ 
                                    marginTop: '0.5rem',
                                    fontSize: '0.7rem', 
                                    color: '#9ca3af',
                                    textAlign: 'center'
                                }}>
                                    ğŸ“Š æ“Šæ•—ï¼š{player.stats.enemiesDefeated} | å¯¶è—ï¼š{player.stats.treasuresFound} | å€åŸŸï¼š{player.stats.areasCleared}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // éŠæˆ²é‚è¼¯æ•ˆæœ
            useEffect(() => {
                if (battleState && battleState.hp <= 0) {
                    const expGained = battleState.exp;
                    const goldGained = battleState.gold;
                    
                    setPlayer(prev => ({
                        ...prev,
                        exp: prev.exp + expGained,
                        gold: prev.gold + goldGained,
                        stats: {
                            ...prev.stats,
                            enemiesDefeated: prev.stats.enemiesDefeated + 1,
                            goldEarned: prev.stats.goldEarned + goldGained
                        }
                    }));
                    
                    addLog(`æ“Šæ•— ${battleState.name}ï¼ç²å¾— ${expGained} ç¶“é©—å€¼ï¼`, "victory");
                    setBattleState(null);
                    
                    if (currentArea < areas.length) {
                        setImage(areas[currentArea].imageKey);
                    }
                    
                    if (player.exp + expGained >= (player.level + 1) * 100) {
                        setTimeout(() => {
                            const newLevel = player.level + 1;
                            const hpIncrease = 25;
                            const mpIncrease = 10;
                            
                            setPlayer(prev => ({
                                ...prev,
                                level: newLevel,
                                maxHp: prev.maxHp + hpIncrease,
                                hp: prev.hp + hpIncrease,
                                maxMp: prev.maxMp + mpIncrease,
                                mp: prev.mp + mpIncrease,
                                attack: prev.attack + 3,
                                defense: prev.defense + 2,
                                exp: prev.exp - (newLevel * 100),
                                skillPoints: prev.skillPoints + 2
                            }));
                            
                            setImage('levelUp');
                            addLog(`ğŸ‰ ç­‰ç´šæå‡ï¼ç­‰ç´š ${newLevel}ï¼`, "level_up");
                            addCombatAnimation("LEVEL UP!", "level_up");
                        }, 1000);
                    }
                    
                    if (battleState.name === "æ¯€æ»…é­”ç‹") {
                        setTimeout(() => setGameState('victory'), 2000);
                    }
                } else if (player.hp <= 0) {
                    setGameState('gameOver');
                } else if (lastAction && lastAction !== "flee_failed" && battleState) {
                    setTimeout(() => {
                        if (!battleState || battleState.hp <= 0) return;
                        
                        let enemyDamage = Math.floor(battleState.attack * (0.8 + Math.random() * 0.4));
                        
                        const defenseBonus = player.statusEffects.find(e => e.type === "defense_boost");
                        if (defenseBonus) {
                            enemyDamage = Math.floor(enemyDamage / defenseBonus.value);
                        }
                        
                        const finalDamage = Math.max(1, enemyDamage - playerStats.defense);
                        setPlayer(prev => ({ ...prev, hp: prev.hp - finalDamage }));
                        
                        addLog(`${battleState.name} é€ æˆ ${finalDamage} å‚·å®³ï¼`, "enemy_attack");
                        addCombatAnimation(`-${finalDamage}`, "enemy_damage");
                        
                        setPlayer(prev => ({
                            ...prev,
                            statusEffects: prev.statusEffects.map(effect => ({
                                ...effect,
                                duration: effect.duration - 1
                            })).filter(effect => effect.duration > 0)
                        }));
                    }, 1500);
                }
                
                setLastAction(null);
            }, [battleState, player.hp, player.exp, player.level, lastAction, addLog, addCombatAnimation, currentArea, setImage]);

            return <div>éŠæˆ²è¼‰å…¥ä¸­...</div>;
        };

        // éŒ¯èª¤è™•ç†
        try {
            ReactDOM.render(<AdventureGame />, document.getElementById('root'));
        } catch (error) {
            console.error('éŠæˆ²è¼‰å…¥éŒ¯èª¤:', error);
            document.getElementById('root').innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    min-height: 100vh;
                    text-align: center;
                    padding: 2rem;
                ">
                    <h1 style="color: #ef4444; margin-bottom: 1rem;">âŒ éŠæˆ²è¼‰å…¥å¤±æ•—</h1>
                    <p style="color: #9ca3af; margin-bottom: 2rem;">è«‹é‡æ–°è¼‰å…¥é é¢</p>
                    <button onclick="location.reload()" style="
                        background: #2563eb;
                        color: white;
                        border: none;
                        padding: 1rem 2rem;
                        border-radius: 0.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                    ">ğŸ”„ é‡æ–°è¼‰å…¥</button>
                </div>
            `;
        }
    </script>
</body>
</html>