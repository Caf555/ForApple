<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹‡è€…å‚³èªªï¼šäº”åŸŸå¾é€” - æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ</title>
    <meta name="description" content="å°ˆç‚ºæ‰‹æ©Ÿå„ªåŒ–çš„æ–‡å­—å†’éšªRPGéŠæˆ²">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
        }

        .game-card {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .btn {
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary { background: linear-gradient(45deg, #dc2626, #ef4444); }
        .btn-secondary { background: linear-gradient(45deg, #2563eb, #3b82f6); }
        .btn-success { background: linear-gradient(45deg, #16a34a, #22c55e); }
        .btn-purple { background: linear-gradient(45deg, #7c3aed, #8b5cf6); }
        .btn-warning { background: linear-gradient(45deg, #d97706, #f59e0b); }

        .health-bar, .mp-bar, .exp-bar {
            transition: width 0.5s ease-in-out;
        }

        @keyframes fadeUp {
            0% { opacity: 1; transform: translateY(0px); }
            100% { opacity: 0; transform: translateY(-30px); }
        }

        .combat-animation {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: fadeUp 2s ease-out forwards;
            z-index: 1000;
        }

        /* æ‰‹æ©Ÿå„ªåŒ–å¸ƒå±€ */
        .mobile-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .top-panel {
            flex-shrink: 0;
        }

        .main-game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .bottom-panel {
            flex-shrink: 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        /* æˆ°é¬¥ç•Œé¢ç‰¹æ®Šå¸ƒå±€ */
        .battle-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .battle-info {
            flex-shrink: 0;
        }

        .battle-log {
            flex: 1;
            min-height: 120px;
            max-height: 200px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .battle-actions {
            flex-shrink: 0;
        }

        /* æ¨™ç±¤é ç³»çµ± */
        .tab-container {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 1rem;
        }

        .tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .tab-content {
            min-height: 200px;
        }

        /* ç·Šæ¹Šçš„æ—¥èªŒæ¨£å¼ */
        .compact-log {
            max-height: 150px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
        }

        .log-entry {
            font-size: 0.8rem;
            padding: 0.4rem;
            margin-bottom: 0.3rem;
            border-radius: 4px;
            line-height: 1.3;
        }

        /* é€²åº¦æ¢å„ªåŒ– */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        /* å¿«é€Ÿè¡Œå‹•åˆ— */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .quick-action-btn {
            padding: 0.75rem 0.5rem;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        /* éŸ¿æ‡‰å¼ç¶²æ ¼ */
        @media (min-width: 768px) {
            .mobile-layout {
                display: grid;
                grid-template-columns: 300px 1fr 300px;
                grid-template-rows: auto 1fr;
                gap: 1rem;
                padding: 1rem;
                max-width: 1400px;
                margin: 0 auto;
            }

            .top-panel {
                grid-column: 1;
                grid-row: 1 / -1;
            }

            .main-game-area {
                grid-column: 2;
                grid-row: 1 / -1;
            }

            .bottom-panel {
                grid-column: 3;
                grid-row: 1 / -1;
                max-height: none;
            }
        }

        @media (max-width: 767px) {
            .mobile-layout {
                padding: 0.5rem;
                gap: 0.75rem;
            }

            .quick-actions {
                grid-template-columns: repeat(4, 1fr);
            }

            .tab {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
        }

        .input-field {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .class-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .class-card {
            padding: 1rem;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .class-card.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .sticky-header {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-size: 1.2rem;
        ">
            âš”ï¸ æ­£åœ¨è¼‰å…¥å‹‡è€…å‚³èªª...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        const AdventureGame = () => {
            const [gameState, setGameState] = useState('menu');
            const [selectedClass, setSelectedClass] = useState(null);
            const [player, setPlayer] = useState({
                name: '',
                class: null,
                level: 1,
                hp: 100,
                maxHp: 100,
                mp: 50,
                maxMp: 50,
                attack: 20,
                defense: 10,
                speed: 15,
                luck: 10,
                exp: 0,
                gold: 100,
                skillPoints: 0,
                inventory: [],
                equipment: {
                    weapon: null,
                    armor: null,
                    accessory: null
                },
                skills: {},
                statusEffects: [],
                stats: {
                    enemiesDefeated: 0,
                    areasCleared: 0,
                    treasuresFound: 0,
                    goldEarned: 0
                }
            });
            const [currentArea, setCurrentArea] = useState(0);
            const [battleState, setBattleState] = useState(null);
            const [gameLog, setGameLog] = useState([]);
            const [gameTime, setGameTime] = useState(0);
            const [lastAction, setLastAction] = useState(null);
            const [activeTab, setActiveTab] = useState('inventory');
            const [combatAnimations, setCombatAnimations] = useState([]);

            // è·æ¥­ç³»çµ±
            const classes = {
                warrior: {
                    name: "æˆ°å£«",
                    emoji: "âš”ï¸",
                    description: "è¿‘æˆ°å°ˆå®¶ï¼Œé«˜æ”»æ“Šå’Œé˜²ç¦¦åŠ›",
                    bonuses: { attack: 10, defense: 8, hp: 30 },
                    skills: ["é‡æ“Š", "é˜²ç¦¦å§¿æ…‹", "æˆ°å¼", "ç‹‚æš´"]
                },
                mage: {
                    name: "æ³•å¸«", 
                    emoji: "ğŸ”®",
                    description: "é­”æ³•ä½¿ç”¨è€…ï¼Œé«˜é­”åŠ›å’ŒæŠ€èƒ½å‚·å®³",
                    bonuses: { attack: 5, defense: 3, mp: 30, luck: 5 },
                    skills: ["ç«çƒè¡“", "æ²»ç™‚è¡“", "å†°ç®­", "é­”æ³•è­·ç›¾"]
                },
                rogue: {
                    name: "ç›œè³Š",
                    emoji: "ğŸ—¡ï¸", 
                    description: "æ•æ·åˆºå®¢ï¼Œé«˜æš´æ“Šå’Œé€Ÿåº¦",
                    bonuses: { attack: 8, speed: 10, luck: 8 },
                    skills: ["èƒŒåˆº", "é–ƒé¿", "æ¯’åˆƒ", "éš±èº«"]
                }
            };

            // æŠ€èƒ½æ•¸æ“šåº«
            const skillDatabase = {
                é‡æ“Š: { mp: 15, damage: 1.8, description: "å¼·åŠ›æ”»æ“Šï¼Œé€ æˆ180%å‚·å®³" },
                é˜²ç¦¦å§¿æ…‹: { mp: 10, defense: 2, duration: 3, description: "3å›åˆå…§é˜²ç¦¦ç¿»å€" },
                æˆ°å¼: { mp: 12, description: "éœ‡æ‡¾æ•µäºº" },
                ç‹‚æš´: { mp: 20, attack: 1.5, duration: 4, description: "4å›åˆå…§æ”»æ“Šæå‡50%" },
                
                ç«çƒè¡“: { mp: 12, damage: 2.0, description: "ç«ç„°é­”æ³•æ”»æ“Š" },
                æ²»ç™‚è¡“: { mp: 15, heal: 0.5, description: "æ¢å¾©50%è¡€é‡" },
                å†°ç®­: { mp: 10, damage: 1.3, description: "å†°ç³»æ”»æ“Š" },
                é­”æ³•è­·ç›¾: { mp: 18, shield: 0.3, duration: 5, description: "é­”æ³•è­·ç›¾" },
                
                èƒŒåˆº: { mp: 10, damage: 2.2, crit: 0.8, description: "é«˜æš´æ“Šæ”»æ“Š" },
                é–ƒé¿: { mp: 8, dodge: 0.7, duration: 2, description: "æå‡é–ƒé¿ç‡" },
                æ¯’åˆƒ: { mp: 14, damage: 1.1, poison: 3, description: "æ¯’æ€§æ”»æ“Š" },
                éš±èº«: { mp: 16, stealth: 3, description: "éš±èº«ç‹€æ…‹" }
            };

            // å€åŸŸæ•¸æ“š
            const areas = [
                {
                    name: "è¿·éœ§æ£®æ—",
                    description: "å¤è€æ£®æ—è¢«ç¥ç§˜è¿·éœ§ç± ç½©...",
                    emoji: "ğŸŒ²",
                    enemies: [
                        { name: "æ£®æ—ç‹¼", hp: 60, attack: 18, defense: 5, exp: 25, gold: 15 },
                        { name: "è…åŒ–æ¨¹ç²¾", hp: 90, attack: 15, defense: 12, exp: 35, gold: 20 },
                        { name: "æ¯’èœ˜è››", hp: 45, attack: 12, defense: 3, exp: 20, gold: 12 }
                    ],
                    boss: { name: "æ£®æ—å®ˆè­·è€…", hp: 200, attack: 25, defense: 15, exp: 100, gold: 80 },
                    treasures: [
                        { name: "æ£®æ—ä¹‹åŠ", type: "weapon", attack: 8, value: 150 },
                        { name: "ç”Ÿå‘½è—¥æ°´", type: "potion", heal: 60, value: 30 },
                        { name: "é€Ÿåº¦ä¹‹é´", type: "accessory", speed: 5, value: 100 }
                    ]
                },
                {
                    name: "è’¼ç©¹å±±è„ˆ", 
                    description: "éšªå³»çš„é›ªå±±ç›´æ’é›²éœ„...",
                    emoji: "â›°ï¸",
                    enemies: [
                        { name: "é›ªè±¹", hp: 75, attack: 22, defense: 8, exp: 30, gold: 18 },
                        { name: "çŸ³å·¨äºº", hp: 120, attack: 28, defense: 20, exp: 45, gold: 25 },
                        { name: "é¢¨æš´é·¹", hp: 65, attack: 20, defense: 6, exp: 28, gold: 22 }
                    ],
                    boss: { name: "å±±è„ˆä¹‹ç‹", hp: 280, attack: 32, defense: 25, exp: 120, gold: 100 },
                    treasures: [
                        { name: "å¯’å†°ä¹‹åŠ", type: "weapon", attack: 12, value: 200 },
                        { name: "é±—ç”²", type: "armor", defense: 12, value: 180 },
                        { name: "é­”åŠ›è—¥æ°´", type: "potion", mp: 40, value: 35 }
                    ]
                },
                {
                    name: "ç„¦ç†±æ²™æ¼ ",
                    description: "ç„¡ç›¡æ²™æµ·åœ¨çƒˆæ—¥ä¸‹é–ƒçˆ...",
                    emoji: "ğŸœï¸", 
                    enemies: [
                        { name: "æ²™è ", hp: 80, attack: 26, defense: 10, exp: 35, gold: 20 },
                        { name: "æ²™å¡µæƒ¡é­”", hp: 100, attack: 30, defense: 8, exp: 50, gold: 30 },
                        { name: "çƒˆæ—¥èœ¥èœ´", hp: 70, attack: 24, defense: 15, exp: 32, gold: 25 }
                    ],
                    boss: { name: "æ²™æ¼ éœ¸ä¸»", hp: 350, attack: 38, defense: 20, exp: 150, gold: 120 },
                    treasures: [
                        { name: "çƒˆç„°ä¹‹åŠ", type: "weapon", attack: 16, value: 300 },
                        { name: "æ²™æ¼ æ–—ç¯·", type: "armor", defense: 10, value: 220 },
                        { name: "å…¨å¾©è—¥æ°´", type: "potion", heal: 100, value: 50 }
                    ]
                },
                {
                    name: "æ¥µå‡å†°åŸ",
                    description: "æ°¸æ†çš„å†°é›ªä¸–ç•Œ...",
                    emoji: "ğŸ§Š",
                    enemies: [
                        { name: "å†°éœœå·¨ç‹¼", hp: 110, attack: 32, defense: 12, exp: 40, gold: 28 },
                        { name: "å†°å…ƒç´ ", hp: 130, attack: 35, defense: 25, exp: 55, gold: 35 },
                        { name: "é›ªæ€ª", hp: 140, attack: 28, defense: 18, exp: 48, gold: 32 }
                    ],
                    boss: { name: "å†°éœœå¥³ç‹", hp: 420, attack: 42, defense: 30, exp: 180, gold: 150 },
                    treasures: [
                        { name: "éœœæœˆä¹‹åŠ", type: "weapon", attack: 20, value: 400 },
                        { name: "é¾é±—ç”²", type: "armor", defense: 18, value: 350 },
                        { name: "ç¥è–è—¥æ°´", type: "potion", heal: 150, value: 80 }
                    ]
                },
                {
                    name: "åœ°ç„ç«å±±",
                    description: "å²©æ¼¿æ²³æµæ·Œè‘—æ­»äº¡...",
                    emoji: "ğŸŒ‹",
                    enemies: [
                        { name: "ç†”å²©ç¸", hp: 120, attack: 36, defense: 15, exp: 45, gold: 30 },
                        { name: "ç«ç„°æƒ¡é­”", hp: 150, attack: 40, defense: 12, exp: 60, gold: 40 },
                        { name: "ç…‰ç„é¨å£«", hp: 160, attack: 38, defense: 22, exp: 65, gold: 45 }
                    ],
                    boss: { name: "ç«ç„°é ˜ä¸»", hp: 500, attack: 45, defense: 25, exp: 200, gold: 180 },
                    treasures: [
                        { name: "è–å…‰åŠ", type: "weapon", attack: 25, value: 600 },
                        { name: "ç†¾å¤©ä½¿è­·ç”²", type: "armor", defense: 25, value: 500 },
                        { name: "ç”Ÿå‘½è–æ³‰", type: "potion", heal: 200, value: 150 }
                    ]
                }
            ];

            const demonKing = {
                name: "æ¯€æ»…é­”ç‹",
                hp: 800,
                maxHp: 800,
                attack: 55,
                defense: 30,
                exp: 500,
                gold: 1000
            };

            // å·¥å…·å‡½æ•¸
            const addLog = useCallback((message, type = "normal") => {
                setGameLog(prev => [...prev.slice(-7), { 
                    message, 
                    type, 
                    timestamp: new Date().toLocaleTimeString() 
                }]);
            }, []);

            const addCombatAnimation = useCallback((text, type = "damage") => {
                const id = Date.now() + Math.random();
                setCombatAnimations(prev => [...prev, { id, text, type }]);
                setTimeout(() => {
                    setCombatAnimations(prev => prev.filter(anim => anim.id !== id));
                }, 2000);
            }, []);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            // éŠæˆ²é‚è¼¯å‡½æ•¸
            const startGame = () => {
                if (player.name.trim() && selectedClass) {
                    const classData = classes[selectedClass];
                    setPlayer(prev => ({
                        ...prev,
                        class: selectedClass,
                        maxHp: prev.maxHp + (classData.bonuses.hp || 0),
                        hp: prev.hp + (classData.bonuses.hp || 0),
                        maxMp: prev.maxMp + (classData.bonuses.mp || 0),
                        mp: prev.mp + (classData.bonuses.mp || 0),
                        attack: prev.attack + classData.bonuses.attack,
                        defense: prev.defense + classData.bonuses.defense,
                        speed: prev.speed + (classData.bonuses.speed || 0),
                        luck: prev.luck + (classData.bonuses.luck || 0),
                        skills: Object.fromEntries(classData.skills.slice(0, 2).map(skill => [skill, 1]))
                    }));
                    setGameState('playing');
                    addLog(`${classData.emoji} ${player.name} é¸æ“‡äº†${classData.name}è·æ¥­ï¼Œé–‹å§‹å†’éšªï¼`, "important");
                }
            };

            useEffect(() => {
                if (gameState === 'playing') {
                    const timer = setInterval(() => {
                        setGameTime(prev => prev + 1);
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gameState]);

            const levelUp = useCallback(() => {
                const newLevel = player.level + 1;
                const hpIncrease = 25;
                const mpIncrease = 10;
                
                setPlayer(prev => ({
                    ...prev,
                    level: newLevel,
                    maxHp: prev.maxHp + hpIncrease,
                    hp: prev.hp + hpIncrease,
                    maxMp: prev.maxMp + mpIncrease,
                    mp: prev.mp + mpIncrease,
                    attack: prev.attack + 3,
                    defense: prev.defense + 2,
                    exp: prev.exp - (newLevel * 100),
                    skillPoints: prev.skillPoints + 2
                }));
                
                addLog(`ğŸ‰ ç­‰ç´šæå‡ï¼ç­‰ç´š ${newLevel}ï¼`, "level_up");
                addCombatAnimation("LEVEL UP!", "level_up");
            }, [player.level, addLog, addCombatAnimation]);

            const getPlayerStats = useCallback(() => {
                let stats = {
                    attack: player.attack,
                    defense: player.defense,
                    speed: player.speed,
                    luck: player.luck
                };
                
                if (player.equipment.weapon) {
                    stats.attack += player.equipment.weapon.attack || 0;
                }
                if (player.equipment.armor) {
                    stats.defense += player.equipment.armor.defense || 0;
                }
                
                return stats;
            }, [player]);

            const useItem = (item, index) => {
                if (item.type === 'potion') {
                    let healAmount = 0;
                    let mpAmount = 0;
                    
                    if (item.heal) {
                        healAmount = Math.min(item.heal, player.maxHp - player.hp);
                        setPlayer(prev => ({ ...prev, hp: prev.hp + healAmount }));
                    }
                    if (item.mp) {
                        mpAmount = Math.min(item.mp, player.maxMp - player.mp);
                        setPlayer(prev => ({ ...prev, mp: prev.mp + mpAmount }));
                    }
                    
                    setPlayer(prev => ({
                        ...prev,
                        inventory: prev.inventory.filter((_, i) => i !== index)
                    }));
                    
                    if (healAmount > 0) addLog(`ä½¿ç”¨ ${item.name}ï¼Œæ¢å¾© ${healAmount} HPï¼`, "heal");
                    if (mpAmount > 0) addLog(`ä½¿ç”¨ ${item.name}ï¼Œæ¢å¾© ${mpAmount} MPï¼`, "heal");
                }
            };

            const equipItem = (item, index) => {
                if (item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory') {
                    const equipType = item.type;
                    const oldEquip = player.equipment[equipType];
                    
                    setPlayer(prev => ({
                        ...prev,
                        equipment: { ...prev.equipment, [equipType]: item },
                        inventory: prev.inventory.filter((_, i) => i !== index)
                    }));
                    
                    if (oldEquip) {
                        setPlayer(prev => ({
                            ...prev,
                            inventory: [...prev.inventory, oldEquip]
                        }));
                    }
                    
                    addLog(`è£å‚™äº† ${item.name}ï¼`, "equipment");
                }
            };

            const learnSkill = (skillName) => {
                if (player.skillPoints > 0 && classes[player.class].skills.includes(skillName)) {
                    setPlayer(prev => ({
                        ...prev,
                        skills: { ...prev.skills, [skillName]: (prev.skills[skillName] || 0) + 1 },
                        skillPoints: prev.skillPoints - 1
                    }));
                    addLog(`å­¸æœƒäº† ${skillName}ï¼`, "skill");
                }
            };

            const useSkill = (skillName) => {
                const skill = skillDatabase[skillName];
                
                if (player.mp < skill.mp) {
                    addLog("MPä¸è¶³ï¼", "error");
                    return false;
                }
                
                setPlayer(prev => ({ ...prev, mp: prev.mp - skill.mp }));
                
                if (skill.damage) {
                    const playerStats = getPlayerStats();
                    let damage = Math.floor(playerStats.attack * skill.damage);
                    
                    const critChance = (skill.crit || 0) + playerStats.luck / 200;
                    const isCrit = Math.random() < critChance;
                    if (isCrit) {
                        damage *= 1.8;
                        addCombatAnimation("CRITICAL!", "critical");
                    }
                    
                    const finalDamage = Math.max(1, damage - (battleState.defense || 0));
                    setBattleState(prev => ({ ...prev, hp: prev.hp - finalDamage }));
                    
                    addLog(`${skillName} é€ æˆ ${finalDamage} å‚·å®³ï¼`, "attack");
                    addCombatAnimation(`-${finalDamage}`, isCrit ? "critical" : "damage");
                    
                    setLastAction("skill");
                    return true;
                } else if (skill.heal) {
                    const healAmount = Math.floor(player.maxHp * skill.heal);
                    setPlayer(prev => ({ ...prev, hp: Math.min(prev.maxHp, prev.hp + healAmount) }));
                    addLog(`${skillName} æ¢å¾© ${healAmount} HPï¼`, "heal");
                    addCombatAnimation(`+${healAmount}`, "heal");
                    setLastAction("skill");
                    return true;
                }
                
                return false;
            };

            const attack = () => {
                const playerStats = getPlayerStats();
                let damage = Math.floor(playerStats.attack * (0.8 + Math.random() * 0.4));
                
                const critChance = 0.1 + playerStats.luck / 200;
                const isCrit = Math.random() < critChance;
                if (isCrit) {
                    damage *= 1.5;
                    addCombatAnimation("CRITICAL!", "critical");
                }
                
                const finalDamage = Math.max(1, damage - (battleState.defense || 0));
                setBattleState(prev => ({ ...prev, hp: prev.hp - finalDamage }));
                
                addLog(`æ”»æ“Šé€ æˆ ${finalDamage} å‚·å®³ï¼`, "attack");
                addCombatAnimation(`-${finalDamage}`, isCrit ? "critical" : "damage");
                
                setLastAction("attack");
            };

            const defend = () => {
                setPlayer(prev => ({
                    ...prev,
                    statusEffects: [...prev.statusEffects, { type: "defense_boost", value: 2, duration: 1 }]
                }));
                addLog("æ¡å–é˜²ç¦¦å§¿æ…‹ï¼", "defend");
                setLastAction("defend");
            };

            const flee = () => {
                if (Math.random() < 0.7) {
                    setBattleState(null);
                    addLog("æˆåŠŸé€ƒè„«äº†ï¼", "flee");
                } else {
                    addLog("é€ƒè„«å¤±æ•—ï¼", "error");
                    setLastAction("flee_failed");
                }
            };

            const enemyTurn = useCallback(() => {
                if (!battleState || battleState.hp <= 0) return;
                
                const playerStats = getPlayerStats();
                let enemyDamage = Math.floor(battleState.attack * (0.8 + Math.random() * 0.4));
                
                const defenseBonus = player.statusEffects.find(e => e.type === "defense_boost");
                if (defenseBonus) {
                    enemyDamage = Math.floor(enemyDamage / defenseBonus.value);
                }
                
                const finalDamage = Math.max(1, enemyDamage - playerStats.defense);
                setPlayer(prev => ({ ...prev, hp: prev.hp - finalDamage }));
                
                addLog(`${battleState.name} é€ æˆ ${finalDamage} å‚·å®³ï¼`, "enemy_attack");
                addCombatAnimation(`-${finalDamage}`, "enemy_damage");
                
                setPlayer(prev => ({
                    ...prev,
                    statusEffects: prev.statusEffects.map(effect => ({
                        ...effect,
                        duration: effect.duration - 1
                    })).filter(effect => effect.duration > 0)
                }));
                
            }, [battleState, player.statusEffects, getPlayerStats, addLog, addCombatAnimation]);

            useEffect(() => {
                if (battleState && battleState.hp <= 0) {
                    const expGained = battleState.exp;
                    const goldGained = battleState.gold;
                    
                    setPlayer(prev => ({
                        ...prev,
                        exp: prev.exp + expGained,
                        gold: prev.gold + goldGained,
                        stats: {
                            ...prev.stats,
                            enemiesDefeated: prev.stats.enemiesDefeated + 1,
                            goldEarned: prev.stats.goldEarned + goldGained
                        }
                    }));
                    
                    addLog(`æ“Šæ•— ${battleState.name}ï¼ç²å¾— ${expGained} ç¶“é©—å€¼ï¼`, "victory");
                    setBattleState(null);
                    
                    if (player.exp + expGained >= (player.level + 1) * 100) {
                        setTimeout(levelUp, 1000);
                    }
                    
                    if (battleState.name === "æ¯€æ»…é­”ç‹") {
                        setTimeout(() => setGameState('victory'), 2000);
                    }
                } else if (player.hp <= 0) {
                    setGameState('gameOver');
                } else if (lastAction && lastAction !== "flee_failed" && battleState) {
                    setTimeout(enemyTurn, 1500);
                }
                
                setLastAction(null);
            }, [battleState, player.hp, player.exp, player.level, lastAction, enemyTurn, levelUp, addLog]);

            const exploreArea = () => {
                const area = areas[currentArea];
                const eventRoll = Math.random();
                
                if (eventRoll < 0.5) {
                    const enemy = area.enemies[Math.floor(Math.random() * area.enemies.length)];
                    setBattleState({ ...enemy, maxHp: enemy.hp, statusEffects: [] });
                    addLog(`é­é‡ ${enemy.name}ï¼`, "encounter");
                } else if (eventRoll < 0.7) {
                    const treasure = area.treasures[Math.floor(Math.random() * area.treasures.length)];
                    setPlayer(prev => ({
                        ...prev,
                        inventory: [...prev.inventory, treasure],
                        stats: { ...prev.stats, treasuresFound: prev.stats.treasuresFound + 1 }
                    }));
                    addLog(`ç™¼ç¾ ${treasure.name}ï¼`, "treasure");
                } else {
                    const goldFound = Math.floor(Math.random() * 50) + 20;
                    setPlayer(prev => ({
                        ...prev,
                        gold: prev.gold + goldFound,
                        stats: { ...prev.stats, goldEarned: prev.stats.goldEarned + goldFound }
                    }));
                    addLog(`ç™¼ç¾ ${goldFound} é‡‘å¹£ï¼`, "gold");
                }
            };

            const nextArea = () => {
                if (currentArea < areas.length - 1) {
                    setCurrentArea(prev => prev + 1);
                    setPlayer(prev => ({
                        ...prev,
                        stats: { ...prev.stats, areasCleared: prev.stats.areasCleared + 1 }
                    }));
                    addLog(`é€²å…¥ ${areas[currentArea + 1].name}ï¼`, "area_change");
                } else {
                    setBattleState({ ...demonKing, statusEffects: [] });
                    addLog("ğŸ”¥ æœ€çµ‚æ±ºæˆ°ï¼æ¯€æ»…é­”ç‹ç¾èº«ï¼", "boss");
                }
            };

            const challengeBoss = () => {
                const area = areas[currentArea];
                setBattleState({ ...area.boss, maxHp: area.boss.hp, statusEffects: [] });
                addLog(`ğŸ’€ ${area.boss.name} ç¾èº«ï¼`, "boss");
            };

            const restartGame = () => {
                setGameState('menu');
                setSelectedClass(null);
                setPlayer({
                    name: '',
                    class: null,
                    level: 1,
                    hp: 100,
                    maxHp: 100,
                    mp: 50,
                    maxMp: 50,
                    attack: 20,
                    defense: 10,
                    speed: 15,
                    luck: 10,
                    exp: 0,
                    gold: 100,
                    skillPoints: 0,
                    inventory: [],
                    equipment: { weapon: null, armor: null, accessory: null },
                    skills: {},
                    statusEffects: [],
                    stats: { enemiesDefeated: 0, areasCleared: 0, treasuresFound: 0, goldEarned: 0 }
                });
                setCurrentArea(0);
                setBattleState(null);
                setGameLog([]);
                setGameTime(0);
                setCombatAnimations([]);
                setActiveTab('inventory');
            };

            // æˆ°é¬¥å‹•ç•«çµ„ä»¶
            const CombatAnimations = () => (
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, pointerEvents: 'none', zIndex: 1000 }}>
                    {combatAnimations.map(anim => (
                        <div
                            key={anim.id}
                            className="combat-animation"
                            style={{
                                left: Math.random() * 60 + 20 + '%',
                                top: Math.random() * 40 + 30 + '%',
                                fontSize: anim.type === 'critical' || anim.type === 'level_up' ? '1.5rem' : '1.2rem',
                                color: 
                                    anim.type === 'critical' ? '#dc2626' :
                                    anim.type === 'damage' ? '#f97316' :
                                    anim.type === 'heal' ? '#22c55e' :
                                    anim.type === 'level_up' ? '#fbbf24' :
                                    '#9ca3af'
                            }}
                        >
                            {anim.text}
                        </div>
                    ))}
                </div>
            );

            // ç·Šæ¹Šé€²åº¦æ¢çµ„ä»¶
            const ProgressBar = ({ label, current, max, color, emoji }) => (
                <div className="progress-container">
                    <span style={{ fontSize: '0.8rem', minWidth: '40px' }}>{emoji}</span>
                    <div className="progress-bar">
                        <div 
                            className="progress-fill"
                            style={{ 
                                width: `${(current / max) * 100}%`,
                                background: color
                            }}
                        />
                    </div>
                    <span style={{ fontSize: '0.8rem', minWidth: '60px' }}>{current}/{max}</span>
                </div>
            );

            // ä¸»éŠæˆ²æ¸²æŸ“
            if (gameState === 'menu') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '600px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ 
                                fontSize: '2.5rem', 
                                fontWeight: 'bold', 
                                marginBottom: '1rem', 
                                color: '#fbbf24'
                            }}>
                                âš”ï¸ å‹‡è€…å‚³èªª âš”ï¸
                            </h1>
                            <h2 style={{ 
                                fontSize: '1.2rem', 
                                marginBottom: '2rem', 
                                color: '#60a5fa'
                            }}>
                                äº”åŸŸå¾é€” - æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ
                            </h2>
                            
                            <div className="game-card" style={{ padding: '1.5rem', marginBottom: '2rem' }}>
                                <p style={{ fontSize: '1rem', marginBottom: '1.5rem' }}>
                                    é¸æ“‡ä½ çš„è·æ¥­ï¼Œé–‹å§‹å²è©©å†’éšªï¼
                                </p>
                                
                                <h3 style={{ fontSize: '1.1rem', marginBottom: '1rem', color: '#fbbf24' }}>é¸æ“‡è·æ¥­</h3>
                                
                                <div className="class-selection" style={{ marginBottom: '1.5rem' }}>
                                    {Object.entries(classes).map(([key, cls]) => (
                                        <div
                                            key={key}
                                            onClick={() => setSelectedClass(key)}
                                            className={`class-card ${selectedClass === key ? 'selected' : ''}`}
                                        >
                                            <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>{cls.emoji}</div>
                                            <h4 style={{ fontSize: '1rem', fontWeight: 'bold', marginBottom: '0.25rem' }}>{cls.name}</h4>
                                            <p style={{ fontSize: '0.8rem', color: '#d1d5db', marginBottom: '0.75rem' }}>
                                                {cls.description}
                                            </p>
                                            <div style={{ fontSize: '0.7rem', textAlign: 'left' }}>
                                                <div>æ”»æ“Š: +{cls.bonuses.attack}</div>
                                                <div>é˜²ç¦¦: +{cls.bonuses.defense}</div>
                                                {cls.bonuses.hp && <div>è¡€é‡: +{cls.bonuses.hp}</div>}
                                                {cls.bonuses.mp && <div>é­”åŠ›: +{cls.bonuses.mp}</div>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <input
                                    type="text"
                                    placeholder="è¼¸å…¥ä½ çš„è‹±é›„åå­—"
                                    value={player.name}
                                    onChange={(e) => setPlayer(prev => ({ ...prev, name: e.target.value }))}
                                    className="input-field"
                                    style={{ marginBottom: '1.5rem', maxWidth: '250px' }}
                                />
                                <br/>
                                <button
                                    onClick={startGame}
                                    disabled={!player.name.trim() || !selectedClass}
                                    className="btn btn-primary"
                                    style={{ 
                                        fontSize: '1rem',
                                        padding: '1rem 2rem',
                                        opacity: (!player.name.trim() || !selectedClass) ? 0.5 : 1
                                    }}
                                >
                                    ğŸš€ é–‹å§‹å†’éšª
                                </button>
                            </div>
                            
                            <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                ğŸ“± æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ | â±ï¸ 30åˆ†é˜å®Œæ•´é«”é©—
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'gameOver') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        background: 'linear-gradient(135deg, #7f1d1d 0%, #450a0a 50%, #000000 100%)',
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '400px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ fontSize: '2rem', fontWeight: 'bold', marginBottom: '1rem', color: '#f87171' }}>
                                ğŸ’€ è‹±é›„éš•è½ ğŸ’€
                            </h1>
                            <div className="game-card" style={{ padding: '1.5rem' }}>
                                <p style={{ fontSize: '1rem', marginBottom: '1.5rem' }}>ä½ çš„å†’éšªå°±æ­¤çµæŸ...</p>
                                <div style={{ marginBottom: '1.5rem', fontSize: '0.9rem' }}>
                                    <div>ç­‰ç´šï¼š{player.level} | æ™‚é–“ï¼š{formatTime(gameTime)}</div>
                                    <div>å€åŸŸï¼š{areas[currentArea]?.name || "é­”ç‹åŸ"}</div>
                                    <div>æ“Šæ•—æ•µäººï¼š{player.stats.enemiesDefeated}</div>
                                </div>
                                <button
                                    onClick={restartGame}
                                    className="btn btn-secondary"
                                    style={{ fontSize: '1rem', padding: '1rem 2rem' }}
                                >
                                    ğŸ”„ é‡æ–°é–‹å§‹
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'victory') {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        background: 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%)',
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                    }}>
                        <div style={{ maxWidth: '500px', width: '100%', textAlign: 'center' }}>
                            <h1 style={{ fontSize: '2.5rem', fontWeight: 'bold', marginBottom: '1rem', color: 'white' }}>
                                ğŸ† å‚³èªªèª•ç”Ÿï¼ ğŸ†
                            </h1>
                            <div className="game-card" style={{ padding: '1.5rem', background: 'rgba(0,0,0,0.7)' }}>
                                <p style={{ fontSize: '1.1rem', marginBottom: '1rem' }}>
                                    ğŸ‰ æ­å–œ {classes[player.class]?.emoji} {player.name}ï¼
                                </p>
                                <p style={{ fontSize: '0.9rem', marginBottom: '1.5rem' }}>
                                    ä½ æˆåŠŸæ“Šæ•—äº†æ¯€æ»…é­”ç‹ï¼Œæ‹¯æ•‘äº†ä¸–ç•Œï¼
                                </p>
                                
                                <div style={{ marginBottom: '1.5rem', fontSize: '0.8rem' }}>
                                    <div>ç­‰ç´šï¼š{player.level} | æ™‚é–“ï¼š{formatTime(gameTime)}</div>
                                    <div>æ“Šæ•—æ•µäººï¼š{player.stats.enemiesDefeated}</div>
                                    <div>æ”¶é›†å¯¶è—ï¼š{player.stats.treasuresFound}</div>
                                </div>
                                
                                <button
                                    onClick={restartGame}
                                    className="btn btn-purple"
                                    style={{ fontSize: '1rem', padding: '1rem 2rem' }}
                                >
                                    âœ¨ é–‹å§‹æ–°å‚³èªª
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // ä¸»éŠæˆ²ç•Œé¢ - æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ
            const playerStats = getPlayerStats();

            return (
                <div className="mobile-layout">
                    <CombatAnimations />
                    
                    {/* é ‚éƒ¨ç‹€æ…‹æ¬„ - å§‹çµ‚å¯è¦‹ */}
                    <div className="top-panel">
                        <div className="game-card sticky-header" style={{ padding: '1rem' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.75rem' }}>
                                <div style={{ fontSize: '1rem', fontWeight: 'bold', color: '#fbbf24' }}>
                                    {classes[player.class]?.emoji} {player.name}
                                </div>
                                <div style={{ fontSize: '0.8rem', color: '#9ca3af' }}>
                                    Lv.{player.level} | â° {formatTime(gameTime)}
                                </div>
                            </div>
                            
                            <ProgressBar 
                                emoji="â¤ï¸" 
                                current={player.hp} 
                                max={player.maxHp} 
                                color="linear-gradient(90deg, #dc2626, #ef4444)" 
                            />
                            <ProgressBar 
                                emoji="âš¡" 
                                current={player.mp} 
                                max={player.maxMp} 
                                color="linear-gradient(90deg, #2563eb, #3b82f6)" 
                            />
                            <ProgressBar 
                                emoji="â­" 
                                current={player.exp} 
                                max={(player.level + 1) * 100} 
                                color="linear-gradient(90deg, #fbbf24, #f59e0b)" 
                            />
                            
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '0.5rem', fontSize: '0.75rem', marginTop: '0.5rem' }}>
                                <div>âš”ï¸ {playerStats.attack}</div>
                                <div>ğŸ›¡ï¸ {playerStats.defense}</div>
                                <div>ğŸ’° {player.gold}</div>
                                <div>ğŸŒŸ {player.skillPoints}</div>
                            </div>
                        </div>
                    </div>

                    {/* ä¸»éŠæˆ²å€åŸŸ */}
                    <div className="main-game-area">
                        <div className="game-card" style={{ padding: '1rem', margin: '0.5rem 0', flex: 1 }}>
                            {/* å€åŸŸæ¨™é¡Œ */}
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1rem' }}>
                                <span style={{ fontSize: '1.5rem' }}>
                                    {currentArea < areas.length ? areas[currentArea].emoji : "ğŸ°"}
                                </span>
                                <div>
                                    <h2 style={{ fontSize: '1.1rem', fontWeight: 'bold', color: '#10b981' }}>
                                        {currentArea < areas.length ? areas[currentArea].name : 'é­”ç‹åŸ'}
                                    </h2>
                                    <p style={{ fontSize: '0.8rem', color: '#d1d5db' }}>
                                        {currentArea < areas.length ? areas[currentArea].description : "æœ€çµ‚æ±ºæˆ°..."}
                                    </p>
                                </div>
                            </div>

                            {/* æˆ°é¬¥ç•Œé¢ - å„ªåŒ–ç‰ˆ */}
                            {battleState ? (
                                <div className="battle-container">
                                    <div className="battle-info">
                                        <div style={{ 
                                            background: 'rgba(127, 29, 29, 0.7)', 
                                            padding: '1rem', 
                                            borderRadius: '0.75rem',
                                            marginBottom: '1rem'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                                                <span style={{ fontWeight: 'bold', fontSize: '1rem' }}>
                                                    {battleState.name} {battleState.name === "æ¯€æ»…é­”ç‹" && "ğŸ‘‘"}
                                                </span>
                                                <span style={{ fontSize: '0.9rem' }}>{battleState.hp}/{battleState.maxHp}</span>
                                            </div>
                                            <div style={{ width: '100%', background: '#374151', borderRadius: '4px', height: '8px' }}>
                                                <div 
                                                    style={{ 
                                                        background: 'linear-gradient(90deg, #dc2626, #ef4444)', 
                                                        height: '100%', 
                                                        borderRadius: '4px',
                                                        width: `${(battleState.hp / battleState.maxHp) * 100}%`,
                                                        transition: 'width 0.5s ease'
                                                    }}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* æˆ°é¬¥æ—¥èªŒ - æ•´åˆåœ¨æˆ°é¬¥ç•Œé¢å…§ */}
                                    <div className="battle-log">
                                        <div className="compact-log">
                                            {gameLog.slice(-5).map((log, index) => (
                                                <div key={index} className="log-entry" style={{
                                                    background: 
                                                        log.type === 'attack' ? 'rgba(239, 68, 68, 0.2)' :
                                                        log.type === 'heal' ? 'rgba(34, 197, 94, 0.2)' :
                                                        log.type === 'victory' ? 'rgba(34, 197, 94, 0.3)' :
                                                        log.type === 'enemy_attack' ? 'rgba(220, 38, 38, 0.2)' :
                                                        'rgba(107, 114, 128, 0.2)',
                                                    color: 
                                                        log.type === 'attack' ? '#fca5a5' :
                                                        log.type === 'heal' ? '#86efac' :
                                                        log.type === 'victory' ? '#86efac' :
                                                        log.type === 'enemy_attack' ? '#fca5a5' :
                                                        '#d1d5db'
                                                }}>
                                                    {log.message}
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* æˆ°é¬¥æŒ‰éˆ• */}
                                    <div className="battle-actions">
                                        <div className="quick-actions">
                                            <button onClick={attack} className="btn btn-primary quick-action-btn">
                                                <span>âš”ï¸</span>
                                                <span>æ”»æ“Š</span>
                                            </button>
                                            <button onClick={defend} className="btn btn-secondary quick-action-btn">
                                                <span>ğŸ›¡ï¸</span>
                                                <span>é˜²ç¦¦</span>
                                            </button>
                                            
                                            {Object.keys(player.skills).slice(0, 2).map(skillName => (
                                                <button
                                                    key={skillName}
                                                    onClick={() => useSkill(skillName)}
                                                    disabled={player.mp < skillDatabase[skillName].mp}
                                                    className="btn btn-purple quick-action-btn"
                                                    style={{ 
                                                        opacity: player.mp < skillDatabase[skillName].mp ? 0.5 : 1
                                                    }}
                                                >
                                                    <span>âœ¨</span>
                                                    <span>{skillName}</span>
                                                </button>
                                            ))}
                                            
                                            {battleState.name !== "æ¯€æ»…é­”ç‹" && (
                                                <button onClick={flee} className="btn btn-warning quick-action-btn">
                                                    <span>ğŸ’¨</span>
                                                    <span>é€ƒè·‘</span>
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                /* æ¢ç´¢ç•Œé¢ */
                                <div>
                                    <div className="quick-actions">
                                        <button onClick={exploreArea} className="btn btn-success quick-action-btn">
                                            <span>ğŸ”</span>
                                            <span>æ¢ç´¢</span>
                                        </button>
                                        
                                        {currentArea < areas.length && (
                                            <>
                                                <button onClick={challengeBoss} className="btn btn-primary quick-action-btn">
                                                    <span>ğŸ’€</span>
                                                    <span>BOSS</span>
                                                </button>
                                                <button onClick={nextArea} className="btn btn-secondary quick-action-btn">
                                                    <span>â¡ï¸</span>
                                                    <span>ä¸‹ä¸€å€</span>
                                                </button>
                                            </>
                                        )}
                                    </div>

                                    {/* éæˆ°é¬¥æ™‚çš„æ—¥èªŒ */}
                                    <div style={{ marginTop: '1rem' }}>
                                        <h4 style={{ fontSize: '0.9rem', marginBottom: '0.5rem', color: '#06b6d4' }}>ğŸ“œ æœ€è¿‘å‹•æ…‹</h4>
                                        <div className="compact-log">
                                            {gameLog.slice(-5).map((log, index) => (
                                                <div key={index} className="log-entry" style={{
                                                    background: 
                                                        log.type === 'treasure' ? 'rgba(245, 158, 11, 0.2)' :
                                                        log.type === 'gold' ? 'rgba(251, 191, 36, 0.2)' :
                                                        log.type === 'encounter' ? 'rgba(239, 68, 68, 0.2)' :
                                                        'rgba(107, 114, 128, 0.2)'
                                                }}>
                                                    {log.message}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* åº•éƒ¨é¢æ¿ - æ¨™ç±¤å¼è¨­è¨ˆ */}
                    <div className="bottom-panel">
                        <div className="game-card" style={{ padding: '1rem', margin: '0.5rem 0' }}>
                            <div className="tab-container">
                                <div 
                                    className={`tab ${activeTab === 'inventory' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('inventory')}
                                >
                                    ğŸ“¦ ç‰©å“
                                </div>
                                <div 
                                    className={`tab ${activeTab === 'skills' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('skills')}
                                >
                                    ğŸŒŸ æŠ€èƒ½
                                </div>
                                <div 
                                    className={`tab ${activeTab === 'progress' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('progress')}
                                >
                                    ğŸ—ºï¸ é€²åº¦
                                </div>
                            </div>

                            <div className="tab-content">
                                {activeTab === 'inventory' && (
                                    <div>
                                        <div style={{ marginBottom: '1rem', fontSize: '0.8rem' }}>
                                            <div>è£å‚™: {player.equipment.weapon?.name || "ç„¡æ­¦å™¨"} | {player.equipment.armor?.name || "ç„¡é˜²å…·"}</div>
                                        </div>
                                        <div style={{ maxHeight: '150px', overflowY: 'auto' }}>
                                            {player.inventory.map((item, index) => (
                                                <div key={index} style={{ 
                                                    display: 'flex',
                                                    justifyContent: 'space-between',
                                                    alignItems: 'center',
                                                    padding: '0.5rem',
                                                    marginBottom: '0.5rem',
                                                    background: 'rgba(255, 255, 255, 0.1)',
                                                    borderRadius: '4px'
                                                }}>
                                                    <div>
                                                        <div style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>{item.name}</div>
                                                        <div style={{ fontSize: '0.7rem', color: '#9ca3af' }}>
                                                            {item.attack && `æ”»æ“Š+${item.attack} `}
                                                            {item.defense && `é˜²ç¦¦+${item.defense} `}
                                                            {item.heal && `æ²»ç™‚${item.heal} `}
                                                        </div>
                                                    </div>
                                                    <div>
                                                        {item.type === 'potion' && (
                                                            <button
                                                                onClick={() => useItem(item, index)}
                                                                className="btn btn-success"
                                                                style={{ fontSize: '0.7rem', padding: '0.25rem 0.5rem' }}
                                                            >
                                                                ä½¿ç”¨
                                                            </button>
                                                        )}
                                                        {(item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory') && (
                                                            <button
                                                                onClick={() => equipItem(item, index)}
                                                                className="btn btn-secondary"
                                                                style={{ fontSize: '0.7rem', padding: '0.25rem 0.5rem' }}
                                                            >
                                                                è£å‚™
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                            {player.inventory.length === 0 && (
                                                <div style={{ textAlign: 'center', color: '#9ca3af', padding: '2rem', fontSize: '0.9rem' }}>
                                                    ç‰©å“æ¬„ç©ºç©ºå¦‚ä¹Ÿ
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'skills' && (
                                    <div>
                                        <div style={{ marginBottom: '1rem', fontSize: '0.8rem', color: '#a855f7' }}>
                                            ğŸŒŸ æŠ€èƒ½é»æ•¸: {player.skillPoints}
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.5rem' }}>
                                            {classes[player.class]?.skills.map(skillName => (
                                                <div key={skillName} style={{ 
                                                    padding: '0.75rem', 
                                                    background: 'rgba(255, 255, 255, 0.1)', 
                                                    borderRadius: '4px' 
                                                }}>
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                                                        <span style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>{skillName}</span>
                                                        <span style={{ fontSize: '0.7rem', background: '#2563eb', padding: '0.125rem 0.25rem', borderRadius: '2px' }}>
                                                            Lv.{player.skills[skillName] || 0}
                                                        </span>
                                                    </div>
                                                    <p style={{ fontSize: '0.7rem', color: '#d1d5db', marginBottom: '0.5rem' }}>
                                                        {skillDatabase[skillName]?.description}
                                                    </p>
                                                    <button
                                                        onClick={() => learnSkill(skillName)}
                                                        disabled={player.skillPoints === 0}
                                                        className="btn btn-purple"
                                                        style={{ 
                                                            width: '100%', 
                                                            fontSize: '0.7rem', 
                                                            padding: '0.25rem',
                                                            opacity: player.skillPoints === 0 ? 0.5 : 1
                                                        }}
                                                    >
                                                        å­¸ç¿’ (1é»)
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'progress' && (
                                    <div>
                                        <div style={{ marginBottom: '1rem' }}>
                                            {areas.map((area, index) => (
                                                <div key={index} style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '0.5rem',
                                                    padding: '0.5rem',
                                                    marginBottom: '0.5rem',
                                                    borderRadius: '4px',
                                                    background: 
                                                        index < currentArea ? 'rgba(34, 197, 94, 0.2)' : 
                                                        index === currentArea ? 'rgba(59, 130, 246, 0.2)' : 'rgba(107, 114, 128, 0.2)'
                                                }}>
                                                    <span style={{ fontSize: '1.2rem' }}>{area.emoji}</span>
                                                    <div style={{ flex: 1 }}>
                                                        <div style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>{area.name}</div>
                                                        <div style={{ fontSize: '0.7rem', color: '#9ca3af' }}>
                                                            {index < currentArea ? 'âœ… å·²å®Œæˆ' : 
                                                             index === currentArea ? 'ğŸ“ ç•¶å‰ä½ç½®' : 'ğŸ”’ æœªè§£é–'}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '0.5rem',
                                                padding: '0.5rem',
                                                borderRadius: '4px',
                                                background: currentArea >= areas.length ? 'rgba(220, 38, 38, 0.2)' : 'rgba(107, 114, 128, 0.2)'
                                            }}>
                                                <span style={{ fontSize: '1.2rem' }}>ğŸ‘‘</span>
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ fontSize: '0.8rem', fontWeight: 'bold' }}>é­”ç‹æ±ºæˆ°</div>
                                                    <div style={{ fontSize: '0.7rem', color: '#9ca3af' }}>
                                                        {currentArea >= areas.length ? 'ğŸ’€ æœ€çµ‚æˆ°é¬¥' : 'ğŸ”’ æœªè§£é–'}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div style={{ fontSize: '0.8rem', background: 'rgba(0,0,0,0.3)', padding: '0.75rem', borderRadius: '4px' }}>
                                            <div style={{ fontWeight: 'bold', marginBottom: '0.5rem', color: '#fbbf24' }}>ğŸ“Š çµ±è¨ˆ</div>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.25rem' }}>
                                                <div>æ“Šæ•—: {player.stats.enemiesDefeated}</div>
                                                <div>å¯¶è—: {player.stats.treasuresFound}</div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // éŒ¯èª¤è™•ç†
        try {
            ReactDOM.render(<AdventureGame />, document.getElementById('root'));
        } catch (error) {
            console.error('éŠæˆ²è¼‰å…¥éŒ¯èª¤:', error);
            document.getElementById('root').innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    min-height: 100vh;
                    text-align: center;
                    padding: 2rem;
                ">
                    <h1 style="color: #ef4444; margin-bottom: 1rem;">âŒ éŠæˆ²è¼‰å…¥å¤±æ•—</h1>
                    <p style="color: #9ca3af; margin-bottom: 2rem;">è«‹é‡æ–°è¼‰å…¥é é¢</p>
                    <button onclick="location.reload()" style="
                        background: #2563eb;
                        color: white;
                        border: none;
                        padding: 1rem 2rem;
                        border-radius: 0.5rem;
                        cursor: pointer;
                        font-size: 1rem;
                    ">ğŸ”„ é‡æ–°è¼‰å…¥</button>
                </div>
            `;
        }
    </script>
</body>
</html>